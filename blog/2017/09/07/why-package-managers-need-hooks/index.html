<!DOCTYPE html>
<html lang="en">
<head prefix="og: http://ogp.me/ns#">
  <meta charset="utf-8">

  <title>Why we think package managers (PMs) need hooks? - Gmagon Software - handy and professional Mac apps.</title>

  <meta http-equiv="X-UA-Compatible" content="IE=8; IE=9; IE=Edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta name="robots" content="noodp" />
  <meta name="keywords" content="Why we think package managers (PMs) need hooks?" />
  <meta name="description" content="Why we think package managers (PMs) need hooks?" />

  <!-- Custom config og:image -->


  <!-- Open Graph -->
<meta name="description" content="Why we think package managers (PMs) need hooks? - Gmagon Software - handy and professional Mac apps.">
<meta property="og:type" content="apps">
<meta property="og:title" content="Why we think package managers (PMs) need hooks? - Gmagon Software - handy and professional Mac apps.">
<meta property="og:url" content="https://gmagon.com/blog/2017/09/07/why-package-managers-need-hooks/index.html">
<meta property="og:site_name" content="Why we think package managers (PMs) need hooks? - Gmagon Software - handy and professional Mac apps.">
<meta property="og:description" content="Why we think package managers (PMs) need hooks? - Gmagon Software - handy and professional Mac apps.">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/800/1*HIEmSy7PaNBd6mhs8-Gddg.png">
<meta property="og:updated_time" content="2017-09-07T05:13:16.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Why we think package managers (PMs) need hooks? - Gmagon Software - handy and professional Mac apps.">
<meta name="twitter:description" content="Why we think package managers (PMs) need hooks? - Gmagon Software - handy and professional Mac apps.">
<meta name="twitter:image" content="https://cdn-images-1.medium.com/max/800/1*HIEmSy7PaNBd6mhs8-Gddg.png">
<meta name="twitter:site" content="gmagonshare">
<meta property="fb:admins" content="432634277117208">
<meat name="twitter:url" content="https://gmagon.com/blog/2017/09/07/why-package-managers-need-hooks/index.html">



  <!-- algolia_config -->
  
  
  <!-- Canonical links -->
  <link rel="canonical" href="https://gmagon.com/blog/2017/09/07/why-package-managers-need-hooks/index.html">

  <!-- Alternative links -->
  

  <!-- Icon -->
  <link rel="apple-touch-icon" sizes="57x57" href="/icon/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icon/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icon/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icon/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icon/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icon/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icon/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icon/apple-touch-icon-152x152.png">
  <link rel="icon" type="image/png" href="/icon/favicon-196x196.png" sizes="196x196">
  <link rel="icon" type="image/png" href="/icon/favicon-160x160.png" sizes="160x160">
  <link rel="icon" type="image/png" href="/icon/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/icon/favicon-16x16.png" sizes="16x16">
  <link rel="icon" type="image/png" href="/icon/favicon-32x32.png" sizes="32x32">
  <meta name="msapplication-TileColor" content="#2f83cd">
  <meta name="msapplication-TileImage" content="/icon/mstile-144x144.png">

  <!-- CSS -->
  <link rel="stylesheet" href="/build/css/navy-17be1eb1e2.css">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="/asset/styles/global.css">
  
  <!-- jQuery -->
  <script src="/js/jquery/jquery-3.2.1.min.js"></script>
<script src="/js/jquery/jquery-migrate-1.4.1.min.js"></script>



  <!-- ForPostLayout -->
  
    
    
  
  <!-- endForPostLayout -->

  <!-- RSS -->
  <link rel="alternate" href="/atom.xml" title="Gmagon Software - handy and professional Mac apps.">

  <!-- algolia_search -->
  <script src="/assets/algolia/algoliasearchLite.min.js" async></script>

  <!-- Utils -->
<script src="/js/utils.js"></script>
</head>

<body>
  <div id="container">
    <header id="header">
  <div class="wrapper">
    <div id="header-inner" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Gmagon Software - handy and professional Mac apps.</a>
        <span>gmagon </span>
      </h1>
      <nav id="main-nav">
        <a href="/" class="main-nav-link ">Home</a><a href="/products/" class="main-nav-link ">Products</a><a href="/guide/" class="main-nav-link ">Guide</a><a href="/support/" class="main-nav-link ">Support</a><a href="/blog/" class="main-nav-link ">Blog</a>
        <div id="search-input-wrap">
          <a href="/search/" class="text-decoration-none ">
            <div id="search-input-icon">
              <i class="fa fa-search"></i>
            </div>
          </a>
        </div>
      </nav>
      <div id="lang-select-wrap">
        <label id="lang-select-label"><i class="fa fa-globe"></i><span>English</span></label>
        <select id="lang-select" data-canonical="">
          
            <option value="en" selected>English</option>
          
        </select>
      </div>
      <a id="mobile-nav-toggle">
        <span class="mobile-nav-toggle-bar"></span>
        <span class="mobile-nav-toggle-bar"></span>
        <span class="mobile-nav-toggle-bar"></span>
      </a>
    </div>
  </div>  
</header>
<div class="hide-wrap-head-top"></div>
    <div class="class-content-wrap">
  <div class="inner">
    <div class="inner-wrap fill-bunting font-e3">
      <h2 id="banner-title"> Why we think package managers (PMs) need hooks? </h2>
      <div id="banner-start">
        <a class="btn btn-static-secondary btn-shadow" href="https://gitter.im/Gmagon/support" ttarget="_blank" rel="nofollow me noopener noreferrer" >Need help?</a>
      </div>
    </div>
  </div>
</div>

<div class="class-content-wrap">
  <div class="wrapper">
    <div class="inner">
      <article class="article-container" itemscope itemtype="http://schema.org/Article">
        <div class="article-inner">
          <div class="article">
          <div class="hide-wrap-head-top"></div>
<article class="article post" itemscope itemtype="http://schema.org/Article">
  <header class="article-header">
    
      <h1 class="article-title" itemprop="name">Why we think package managers (PMs) need hooks?</h1>
    
    <a href="/blog/2017/09/07/why-package-managers-need-hooks/" class="article-date"><time datetime="2017-09-07T00:00:00.000Z">2017-09-07</time></a>
  </header>
  <div class="article-content" itemprop="articleBody">
    <p>We introduced hooks to pnpm in <a href="https://github.com/pnpm/pnpm/releases/tag/v1.12.0">version 1.12</a>. In this article I want to write about why we think package managers (PMs) need hooks.</p>
<h3 id="Why-would-we-want-to-hook-into-node-modules"><a href="#Why-would-we-want-to-hook-into-node-modules" class="headerlink" title="Why would we want to hook into `node_modules`?"></a>Why would we want to hook into `node_modules`?</h3><p>When installing dependencies of a Node-project, the<code>node_modules</code>structure is 100% controlled by the<code>package.json</code>files of the dependencies (a.k.a. manifests). So if your project depends on<code>foo@1.0.0</code>which depends on<code>bar@2.0.0</code>then you’ll be going to have two dependencies installed in your<code>node_modules</code>. While you can change your project’s dependency set, you don’t have control over the manifests of your dependencies.</p>
<p>A typical dependency tree is huge and you have no ownership over the majority of your dependencies. Just analyze any of your dependencies at <a href="http://npm.anvaka.com/">npm.anvaka.com</a>.</p>
<p><img src="https://cdn-images-1.medium.com/max/800/1*HIEmSy7PaNBd6mhs8-Gddg.png" alt=""></p>
<p>The dependency graph of browserify</p>
<p>What to do if there is a bug in one of the packages inside your<code>node_modules</code>? If the issue is in a root dependency, then you have 3 options:</p>
<ol>
<li>find an alternative, more reliable package</li>
<li>submit a pull request (PR) that fixes the issue</li>
<li>create your own package and use it instead of the buggy one</li>
</ol>
<p>The 2nd option seems to be the correct one and I encourage everyone to contribute as frequently as possible. However, submitting a PR doesn’t mean that your changes will be merged/published. Even if they will be merged and published, it won’t happen immediately, you might have to wait for years. Here are some frequent issues:</p>
<ul>
<li>the project is unmaintained/poorly maintained</li>
<li>you did breaking changes and the author doesn’t like bumping major versions. The author will wait for several breaking changes to come in, before publishing a major version</li>
<li>the author thinks the bug is not a bug</li>
</ul>
<p>If the problematic package is a root dependency, then you can easily switch to another package or to your fork. The problem is match harder to solve if the package is a sub-dependency. In that case, your options are:</p>
<ol>
<li>submit a PR that fixes the issue</li>
<li>submit many PRs to packages that depend on the buggy package</li>
</ol>
<p>With hooks though, you can have a third option: create a fork and install it instead of the problematic package. So if you have<code>foo@1.0.0</code>that depends on<code>bar@2.0.0</code>you can have a hook that will override the dependency.</p>
<p>Let’s say there is a bug in<code>bar@2.0.0</code>and you submitted a PR with a fix. However, the maintainer of<code>bar</code>is on vacation. You can use a hook to make pnpm install<code>bar</code>from your PR branch instead of<code>bar@2.0.0</code>from the npm registry.</p>
<h3 id="Why-hooks-are-important-for-pnpm’s-survival"><a href="#Why-hooks-are-important-for-pnpm’s-survival" class="headerlink" title="Why hooks are important for pnpm’s survival"></a>Why hooks are important for pnpm’s survival</h3><p>Hooks are nice to have in any PM but for pnpm they are especially important. As you may know already, pnpm creates a strict symlinked<code>node_modules</code>structure. You can read more about it in:</p>
<p><a href="https://medium.com/pnpm/pnpms-strictness-helps-to-avoid-silly-bugs-9a15fb306308"><strong>pnpm’s strictness helps to avoid silly bugs</strong><br>_pnpm is a package manager for Node.js. I have written an article earlier about why should we use pnpm. In this article…_medium.com</a></p>
<p>Although the<code>node_modules</code>structure created by pnpm is Node.js-compatible, many packages have bugs that show up only when installed via pnpm. As a consequence, pnpm has issues with some popular frameworks and tools.</p>
<p>Of course, we try to solve these issues via PRs (I want to give a shout out to <a href="https://github.com/aecz">aecz</a> who managed to fix many such issues in Angular). But besides the usual issues, some of the maintainers are hostile and refuse to accept PRs just because they don’t like pnpm or believe that the flat<code>node_modules</code>created by npm/Yarn is a feature (it is not).</p>
<p>In the end, we have two options to fix the ecosystem for the strict pnpm:</p>
<ol>
<li>make pnpm popular enough. In that case, authors of frameworks/toolings will be testing their product with pnpm as well as npm and Yarn.</li>
<li>make a hook system to temporarily substitute the buggy packages that don’t work with pnpm.</li>
</ol>
<p>IMHO, the 1st scenario is pretty much impossible. pnpm can’t become popular without being a drop-in replacement for npm.</p>
<h3 id="Real-life-example"><a href="#Real-life-example" class="headerlink" title="Real-life example"></a>Real-life example</h3><p>There is a popular package called <a href="https://github.com/browserify/resolve">resolve</a> for resolving dependencies from<code>node_modules</code>(1,3K dependents, 765K downloads a day). Unfortunately for pnpm,<code>resolve</code>preserves symlinks when resolving modules. This is an issue on resolve’s end as Node.js does not preserve symlinks during resolution. I did a <a href="https://github.com/browserify/resolve/pull/131">PR</a> to fix this issue and now resolve from version 1.4 has an option to not preserve symlinks.</p>
<p>This does not solve the problem for pnpm though. We can’t submit PRs to the 1.3K dependent packages to update<code>resolve</code>and pass<code>preserverSymlink: false</code>to it. The lead maintainer of resolve agreed to switch the option’s default value in the next major version. So I hoped Greenkeeper would create the PRs for us and most of the packages would update resolve to version 2.</p>
<p>I created another <a href="https://github.com/browserify/resolve/pull/135">PR</a> with the breaking change but resolve’s maintainer wants to wait for more breaking changes before changing resolve to version 2.</p>
<p>I realized that we cannot change the world but we can change pnpm, so I released the<code>readPackage</code>hook. My changes to resolve are available via my fork on GitHub, so all we have to do is to tell pnpm to install resolve from the fork. This can be done by declaring the hook in a file called<code>pnpmfile.js</code>:</p>
<p>During installation, pnpm will pass every<code>package.json</code>to this hook first and use the version of the<code>package.json</code>returned by the hook. So it won’t matter on which version of resolve the package depends, my fork will be installed instead and the project will work fine with pnpm.</p>
<h3 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h3><p>I did not describe all the use cases when the<code>readPackage</code>can be useful. It is a really powerful tool and I think we’ll learn how to use it smartly.</p>
<p>Also, I want to say thanks to <a href="https://medium.com/@andreineculau">Andrei Neculau</a>, who convinced me that this hook-system was a good idea.</p>
<p>To make it a little bit interactive, check how many unresolved PRs you have on GitHub and post the number in the comments section. You can use <a href="https://github.com/pulls">this link</a> to see all your open PRs.</p>
<hr>
<h3 id="Do-you-want-to-give-pnpm-a-try"><a href="#Do-you-want-to-give-pnpm-a-try" class="headerlink" title="Do you want to give pnpm a try?"></a>Do you want to give pnpm a try?</h3><p>Just install pnpm via npm:<code>npm install -g pnpm</code>. And use it instead of npm whenever you want to install something:<code>pnpm i foo</code>.</p>
<p>Also, you can read more info at the <a href="https://github.com/pnpm/pnpm">pnpm GitHub repo</a> or <a href="https://pnpm.js.org/">pnpm.js.org</a>. You can follow <a href="https://twitter.com/pnpmjs">pnpm on Twitter</a> or ask for help at the <a href="https://gitter.im/pnpm/pnpm">pnpm Gitter Chat Room</a>.</p>
<p>Source: <a href="https://medium.com/pnpm/why-package-managers-need-hook-systems-b8125d8b3dc7">https://medium.com/pnpm/why-package-managers-need-hook-systems-b8125d8b3dc7</a></p>

  </div>
  

 <!-- jsSocials -->
<script src="/jssocials-1.4.0/jssocials.min.js"></script>
<link rel="stylesheet" href="/jssocials-1.4.0/jssocials.css">
<link rel="stylesheet" href="/jssocials-1.4.0/jssocials-theme-flat.css">

<div class="socials-share-btn"></div>
<script>
  if ($) {
    $(document).ready(function(){
      $(".socials-share-btn").jsSocials({
        shares: ["email", "twitter", "facebook", "googleplus", "linkedin", "pinterest", "stumbleupon", "whatsapp"]
      });
    })
  }
</script>


  
<section id="comments">
  <div id="disqus_thread"></div>
</section>
<script>
  var disqus_shortname = 'gmagon';
  var disqus_url = 'https://gmagon.com/blog/2017/09/07/why-package-managers-need-hooks/index.html';
  var disqus_title = "Why we think package managers (PMs) need hooks?";
  var disqus_config = function(){
    this.language = 'en';
  };
  (function(){
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'https://go.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

  <script src="/js/audios.js"></script>
</article>

          </div>
      
          <aside id="article-toc" role="navigation">
                <div id="article-toc-inner">
                  <strong class="sidebar-title">Contents</strong>
                  <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Why-would-we-want-to-hook-into-node-modules"><span class="toc-text">Why would we want to hook into `node_modules`?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Why-hooks-are-important-for-pnpm’s-survival"><span class="toc-text">Why hooks are important for pnpm’s survival</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Real-life-example"><span class="toc-text">Real-life example</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Summary"><span class="toc-text">Summary</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Do-you-want-to-give-pnpm-a-try"><span class="toc-text">Do you want to give pnpm a try?</span></a></li></ol>
                  <a href="#" id="article-toc-top">Back to Top</a>
                </div>
          </aside>
        </div>
      </article>
    </div>
  </div>
</div>

<div class="class-content-wrap">
  <div class="inner">
    <div class="inner-wrap landing-bunting">
      <div class="intro-sub-content-wrap">
      </div>
    </div>
  </div>
</div>



    <footer id="footer" class="landing-bunting font-e3">
  <div class="inner">
    <div id="footer-some-docs">
        <a href="/terms_conditions.html" class="footer-doc-link" >Terms & Conditions</a>
        <a href="/privacy.html" class="footer-doc-link" >Privacy</a>
        <a href="/end-user-license-agreement.html" class="footer-doc-link" >License Agreement</a>
    </div>
    <div id="footer-copyright">
       <a href="" > Copyright &copy; 2017 Gmagon,Inc. All rights reserved. </a>
    </div>
  </div>

  <div class="inner">
    <div id="footer-links">
        
        <a href="https://twitter.com/gmagonshare" class="footer-link" target="_blank" rel="nofollow me noopener noreferrer" ><i class="fa fa-twitter"></i></a>
        
        <a href="https://www.facebook.com/gmagonshare" class="footer-link" target="_blank" rel="nofollow me noopener noreferrer" ><i class="fa fa-facebook"></i></a>
        <a href="https://www.youtube.com/gmagonshare" class="footer-link" target="_blank" rel="nofollow me noopener noreferrer" ><i class="fa fa-youtube"></i></a>
        <a href="https://www.instagram.com/gmagonshare" class="footer-link" target="_blank" rel="nofollow me noopener noreferrer" ><i class="fa fa-instagram"></i></a>
    </div>
  </div>


  <div class="inner">
    <div id="footer-security">
       <p>
          <img src="/asset/images/security/klogo.png">
          <img src="/asset/images/security/mcafee.png">
          <img src="/asset/images/security/cmmodo_scanned.png">
          <img src="/asset/images/security/softonic_tested.png">
          <img src="/asset/images/security/tested_by_sucuri.png">
          <img src="/asset/images/security/norton.png">
          <img src="/asset/images/security/eset_logo.png">
       </p>
    </div>
  </div>




</footer>

  </div>
  <div id="mobile-nav-dimmer"></div>
  <nav id="mobile-nav">
  <div id="mobile-nav-inner">
    <ul id="mobile-nav-list">
      <a href="/" class="mobile-nav-link ">Home</a><a href="/products/" class="mobile-nav-link ">Products</a><a href="/guide/" class="mobile-nav-link ">Guide</a><a href="/support/" class="mobile-nav-link ">Support</a><a href="/blog/" class="mobile-nav-link ">Blog</a>
      
    </ul>
    
  </div>
  <div id="mobile-lang-select-wrap">
    <span id="mobile-lang-select-label"><i class="fa fa-globe"></i><span>English</span></span>
    <select id="mobile-lang-select" data-canonical="">
      
        <option value="en" selected>English</option>
      
    </select>
  </div>
</nav>

  <!-- Scripts -->
<script src="/build/js/main-8277743eaa.js"></script>
<!-- <script src="https://cdn.jsdelivr.net/retinajs/1.3.0/retina.min.js" async></script> -->

<!-- totop -->
<div id="gmagon_totop" style="position:fixed;bottom:150px;right:30px;cursor: pointer;">
  <a title="Back to top"><img src="/asset/images/scroll-up.png"/></a>
</div>
<script src="/js/totop.js"></script>





<!-- Google Analytics -->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-99314951-1', 'auto');
  ga('send', 'pageview');
</script>


</body>
</html>