<!DOCTYPE html>
<html lang="en">
<head prefix="og: http://ogp.me/ns#">
  <meta charset="utf-8">

  <title>Introduction of WhiteBear - Gmagon Software - handy and professional Mac apps.</title>

  <meta http-equiv="X-UA-Compatible" content="IE=8; IE=9; IE=Edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta name="robots" content="noodp" />
  <meta name="keywords" content="Introduction of WhiteBear" />
  <meta name="description" content="Introduction of WhiteBear" />

  <!-- Custom config og:image -->


  <!-- Open Graph -->
<meta name="description" content="Introduction of WhiteBear - Gmagon Software - handy and professional Mac apps.">
<meta property="og:type" content="apps">
<meta property="og:title" content="Introduction of WhiteBear - Gmagon Software - handy and professional Mac apps.">
<meta property="og:url" content="https://gmagon.com/blog/2017/08/31/introduction-of-whitebear/index.html">
<meta property="og:site_name" content="Introduction of WhiteBear - Gmagon Software - handy and professional Mac apps.">
<meta property="og:description" content="Introduction of WhiteBear - Gmagon Software - handy and professional Mac apps.">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://img0.tuicool.com/3qAfIvy.png!web">
<meta property="og:image" content="http://img1.tuicool.com/EFRbQ3Q.png!web">
<meta property="og:image" content="http://img0.tuicool.com/E3eM3iN.png!web">
<meta property="og:updated_time" content="2017-08-31T10:51:44.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Introduction of WhiteBear - Gmagon Software - handy and professional Mac apps.">
<meta name="twitter:description" content="Introduction of WhiteBear - Gmagon Software - handy and professional Mac apps.">
<meta name="twitter:image" content="http://img0.tuicool.com/3qAfIvy.png!web">
<meta name="twitter:site" content="gmagonshare">
<meta property="fb:admins" content="432634277117208">
<meat name="twitter:url" content="https://gmagon.com/blog/2017/08/31/introduction-of-whitebear/index.html">



  <!-- algolia_config -->
  
  
  <!-- Canonical links -->
  <link rel="canonical" href="https://gmagon.com/blog/2017/08/31/introduction-of-whitebear/index.html">

  <!-- Alternative links -->
  

  <!-- Icon -->
  <link rel="apple-touch-icon" sizes="57x57" href="/icon/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icon/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icon/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icon/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icon/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icon/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icon/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icon/apple-touch-icon-152x152.png">
  <link rel="icon" type="image/png" href="/icon/favicon-196x196.png" sizes="196x196">
  <link rel="icon" type="image/png" href="/icon/favicon-160x160.png" sizes="160x160">
  <link rel="icon" type="image/png" href="/icon/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/icon/favicon-16x16.png" sizes="16x16">
  <link rel="icon" type="image/png" href="/icon/favicon-32x32.png" sizes="32x32">
  <meta name="msapplication-TileColor" content="#2f83cd">
  <meta name="msapplication-TileImage" content="/icon/mstile-144x144.png">

  <!-- CSS -->
  <link rel="stylesheet" href="/build/css/navy-041a6b0522.css">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="/asset/styles/global.css">
  
  <!-- jQuery -->
  <script src="/js/jquery/jquery-3.2.1.min.js"></script>
<script src="/js/jquery/jquery-migrate-1.4.1.min.js"></script>



  <!-- ForPostLayout -->
  
    
    
  
  <!-- endForPostLayout -->

  <!-- RSS -->
  <link rel="alternate" href="/atom.xml" title="Gmagon Software - handy and professional Mac apps.">

  <!-- algolia_search -->
  <script src="/assets/algolia/algoliasearchLite.min.js" async></script>

  <!-- Github Button -->
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  <!-- Utils -->
<script src="/js/utils.js"></script>
</head>

<body>
  <div id="container">
    <header id="header">
  <div class="wrapper">
    <div id="header-inner" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Gmagon Software - handy and professional Mac apps.</a>
        <span>gmagon </span>
      </h1>
      <nav id="main-nav">
        <a href="/" class="main-nav-link ">Home</a><a href="/products/" class="main-nav-link ">Products</a><a href="/guide/" class="main-nav-link ">Guide</a><a href="/support/" class="main-nav-link ">Support</a><a href="/blog/" class="main-nav-link ">Blog</a>
        <div id="search-input-wrap">
          <a href="/search/" class="text-decoration-none">
            <div id="search-input-icon">
              <i class="fa fa-search"></i>
            </div>
          </a>
        </div>
      </nav>
      <div id="lang-select-wrap">
        <label id="lang-select-label"><i class="fa fa-globe"></i><span>English</span></label>
        <select id="lang-select" data-canonical="">
          
            <option value="en" selected>English</option>
          
        </select>
      </div>
      <a id="mobile-nav-toggle">
        <span class="mobile-nav-toggle-bar"></span>
        <span class="mobile-nav-toggle-bar"></span>
        <span class="mobile-nav-toggle-bar"></span>
      </a>
    </div>
  </div>  
</header>
<div class="hide-wrap-head-top"></div>

    <div class="class-content-wrap">
  <div class="inner">
    <div class="inner-wrap fill-bunting font-e3">
      <h2 id="banner-title"> Introduction of WhiteBear </h2>
      <div id="banner-start">
        <a class="btn btn-static-secondary btn-shadow" href="https://gitter.im/Gmagon/support" ttarget="_blank" rel="nofollow me noopener noreferrer" >Need help?</a>
      </div>
    </div>
  </div>
</div>

<div class="class-content-wrap">
  <div class="wrapper">
    <div class="inner">
      <article class="article-container" itemscope itemtype="http://schema.org/Article">
        <div class="article-inner">
          <div class="article">
          <div class="hide-wrap-head-top"></div>
<article class="article post" itemscope itemtype="http://schema.org/Article">
  <header class="article-header">
    
      <h1 class="article-title" itemprop="name">Introduction of WhiteBear</h1>
    
    <a href="/blog/2017/08/31/introduction-of-whitebear/" class="article-date"><time datetime="2017-08-31T00:00:00.000Z">2017-08-31</time></a>
  </header>
  <div class="article-content" itemprop="articleBody">
    <p>As a part of our Kaspersky APT Intelligence Reporting subscription, customers received an update in mid-February 2017 on some interesting APT activity that we called WhiteBear. Much of the contents of that report are reproduced here. WhiteBear is a parallel project or second stage of the Skipper Turla cluster of activity documented in another private intelligence report “Skipper Turla – the White Atlas framework” from mid-2016. Like previous Turla activity, WhiteBear leverages compromised websites and hijacked satellite connections for command and control (C2) infrastructure. As a matter of fact, WhiteBear infrastructure has overlap with other Turla campaigns, like those deploying Kopiluwak, as documented in “KopiLuwak – A New JavaScript Payload from Turla” in December 2016. WhiteBear infected systems maintained a dropper (which was typically signed) as well as a complex malicious platform which was always preceded by WhiteAtlas module deployment attempts. However, despite the similarities to previous Turla campaigns, wlieve that WhiteBear is a distinct project with a separate focus. We note that this observation of delineated target focus, tooling, and project context is an interesting one that also can be repeated across broadly labeled Turla and Sofacy activity.</p>
<p>From February to September 2016, WhiteBear activity was narrowly focused on embassies and consular operations around the world. All of these early WhiteBear targets were related to embassies and diplomatic/foreign affair organizations. Continued WhiteBear activity later shifted to include defense-related organizations into June 2017. When compared to WhiteAtlas infections, WhiteBear deployments are relatively rare and represent a departure from the broader Skipper Turla target set. Additionally, a comparison of the WhiteAtlas framework to WhiteBear components indicates that the malware is the product of separate development efforts. WhiteBear infections appear to be preceded by a condensed spearphishing dropper, lack Firefox extension installer payloads, and contain several new components signed with a new code signing digital certificate, unlike WhiteAtlas incidents and modules.</p>
<p><img src="http://img0.tuicool.com/3qAfIvy.png!web" alt=""></p>
<p>The exact delivery vector for WhiteBear components is unknown to us, although we have very strong suspicion the group spearphished targets with malicious pdf files. The decoy pdf document above was likely stolen from a target or partner. And, although WhiteBear components have been consistently identified on a subset of systems previously targeted with the WhiteAtlas framework, and maintain components within the same filepaths and can maintain identical filenames, we were unable to firmly tie delivery to any specific WhiteAtlas component. WhiteBear focused on various embassies and diplomatic entities around the world in early 2016 – tellingly, attempts were made to drop and display decoy pdf’s with full diplomatic headers and content alongside executable droppers on target systems.</p>
<h2 id="Technical-Details"><a href="#Technical-Details" class="headerlink" title="Technical Details"></a>Technical Details</h2><p>The WhiteBear platform implements an elaborate set of messaging and injection components to support full presence on victim hosts. A diagram helps to visualize the reach of injected components on the system.</p>
<p><img src="http://img1.tuicool.com/EFRbQ3Q.png!web" alt=""></p>
<h3 id="WhiteBear-Binary-loader"><a href="#WhiteBear-Binary-loader" class="headerlink" title="WhiteBear Binary loader"></a>WhiteBear Binary loader</h3><p>Sample MD5:b099b82acb860d9a9a571515024b35f0</p>
<p>TypePE EXE</p>
<p>Compilation timestamp2002.02.05 17:36:10 (GMT)</p>
<p>Linker version10.0 (MSVC 2010)</p>
<p>Signature“Solid Loop Ldt” UTCTime 15/10/2015 00:00:00 GMT – UTCTime 14/10/2016 23:59:59 GMT</p>
<p>The WhiteBear binary loader maintains several features including two injection methods for its (oddly named) “KernelInjector” subsystem, also named by its developer</p>
<p>– Standart</p>
<p>– WindowInject (includes an unusual technique for remotely placing code into memory for subsequent thread execution)</p>
<p>The loader also maintains two methods for privilege and DEP process protection handling:</p>
<p>– GETSID_METHOD_1</p>
<p>– GETSID_METHOD_2</p>
<p>The binary contains two resources:</p>
<p>– BINARY 201</p>
<p>– File size: 128 bytes</p>
<p>– Contains the string, “explorer.exe”</p>
<p>– BINARY 202</p>
<p>– File size: 403456 bytes</p>
<p>– File Type: PE file (this is the actual payload and is not encrypted)</p>
<p>– This PE file resource stores the “main orchestrator” .dll file</p>
<p>Loader runtime flow</p>
<p>The loader creates the mutex “{531511FA-190D-5D85-8A4A-279F2F592CC7}”, and waits up to two minutes if it is already present while logging the message “IsLoaderAlreadyWork +”. The loader creates the mutex “{531511FA-190D-5D85-8A4A-279F2F592CC7}”, and waits up to two minutes. If it is already present while logging the message “IsLoaderAlreadyWork +”, it extracts the resource BINARY 201. This resource contains a wide string name of processes to inject into (i.e. “explorer.exe”).</p>
<p>The loader makes a pipe named: \.\pipe\Winsock2\CatalogChangeListener-%03x%01x-%01x</p>
<p>Where the “%x” parameter is replaced with the values 0xFFFFFFFF 0xEEEEEEEE 0xDDDDDDDD, or if it has successfully obtained the user’s SID:</p>
<p>\.\pipe\Winsock2\CatalogChangeListener-%02x%02x-%01x</p>
<p>With “%x” parameters replaced with numbers calculated from the current date and a munged user SID.</p>
<p>The pipe is used to communicate with the target process and the transport module; the running code also reads its own image body and writes it to the pipe. The loader then obtains the payload body from resource BINARY 202. It finds the running process that matches the target name, copies the buffer containing the payload into the process, then starts its copy in the target process.</p>
<p>There are some interesting, juvenile, and non-native English-speaker debug messages compiled into the code:</p>
<p>– i cunt waiting anymore #%d</p>
<p>– lights aint turnt off with #%d</p>
<p>– Not find process</p>
<p>– CMessageProcessingSystem::Receive_NO_CONNECT_TO_GAYZER</p>
<p>– CMessageProcessingSystem::Receive_TAKE_LAST_CONNECTION</p>
<p>– CMessageProcessingSystem::Send_TAKE_FIN</p>
<h3 id="WhiteBear-Main-module-orchestrator"><a href="#WhiteBear-Main-module-orchestrator" class="headerlink" title="WhiteBear Main module/orchestrator"></a>WhiteBear Main module/orchestrator</h3><p>Sample MD5: 06bd89448a10aa5c2f4ca46b4709a879</p>
<p>Type, size: PE DLL, 394 kb</p>
<p>Compilation timestamp: 2002.02.05 17:31:28 (GMT)</p>
<p>Linker version: 10.0 (MSVC 2010)</p>
<p>Unsigned Code</p>
<p>The main module has no exports, only a DllMain entry which spawns one thread and returns. The main module maintains multiple BINARY resources that include executable, configurations, and encryption data:</p>
<p>101 – RSA private (!) key</p>
<p>102 – RSA public key</p>
<p>103 – empty</p>
<p>104 – 16 encrypted bytes</p>
<p>105 – location (“%HOMEPATH%\ntuser.dat.LOG3”)</p>
<p>106 – process names (e.g. “iexplore.exe, firefox.exe, chrome.exe, outlook.exe, safari.exe, opera.exe”) to inject into</p>
<p>107 – Transport module for interaction with C&amp;C</p>
<p>108 – C2 configuration</p>
<p>109 – Registry location (“\HKCU\SOFTWARE\Microsoft\WindowsNT\CurrentVersion\Explorer\Screen Saver”)</p>
<p>110 – no information</p>
<p>111 – 8 zero bytes</p>
<p>Values 104 – 111 are encrypted with the RSA private key (resource 101) and compressed with bzip2.4. The RSA key is stored with header stripped in a format similar to Microsoft’s PVK; the RSA PRIVATE KEY header is appended by the loader before reading the keys into the encryption code. Resource 109 points to a registry location called “external storage”, built-in resources are called “PE Storage”.</p>
<p>In addition to storing code, crypto resources, and configuration data in PE resources, WhiteBear copies much of this data to the victim host’s registry. Registry storage is located in the following keys. Subkeys and stored values listed below:</p>
<p>[HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\ScreenSaver] [HKCU\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Explorer\ScreenSaver]</p>
<p>Registry subkeys:</p>
<p>{629336E3-58D6-633B-5182-576588CF702A} Contains the RSA private key used to encrypt/decrypt other resources / resource 101</p>
<p>{3CDC155D-398A-646E-1021-23047D9B4366} Resource 105 – current file location</p>
<p>{81A03BF8-60AA-4A56-253C-449121D61CAF} Resource 106 – process names</p>
<p>{31AC34A1-2DE2-36AC-1F6E-86F43772841F} Contains the internet C&amp;C transport module / resource 107</p>
<p>{8E9810C5-3014-4678-27EE-3B7A7AC346AF} Resource 108 – C&amp;C config</p>
<p>{28E74BDA-4327-31B0-17B9-56A66A818C1D} Resource 110 “plugins”</p>
<p>{4A3130BD-2608-730F-31A7-86D16CE66100} Resource 111</p>
<p>{119D263D-68FC-1942-3CA3-46B23FA652A0} Unique Guid (“ObjectID”)</p>
<p>{1DC12691-2B24-2265-435D-735D3B118A70} “Task Queue”</p>
<p>{6CEE6FE1-10A2-4C33-7E7F-855A51733C77} “Result Queue”</p>
<p>{56594FEA-5774-746D-4496-6361266C40D0}  unknown</p>
<p>{831511FA-190D-5D85-8A4A-279F2F592CC7}  unknown</p>
<p>Finally, if the main WhiteBear module fails to use registry storage, it uses “FS Storage” in file %TEMP%\KB943729.log. The module reads all of its data and binary components from one of the storages and then verifies the integrity of data (RSA+bzip2 compression+signature).</p>
<p>The module maintains functionality which is divided into a set of subsystems that are loosely named by the developers:</p>
<p>• result queue</p>
<p>• task queue</p>
<p>• message processing system</p>
<p>• autorun manager</p>
<p>• execution subsystem</p>
<p>• inject manager</p>
<p>• PEStorage</p>
<p>• local transport manager/internal transport channel</p>
<p>It creates the following temporary files:</p>
<p>%TEMP%\CVRG72B5.tmp.cvr</p>
<p>%TEMP%\CVRG1A6B.tmp.cvr</p>
<p>%TEMP%\CVRG38D9.tmp.cvr</p>
<p>%TEMP%~DF1E05.tmp contains the updated body of the loader during an update.</p>
<p>Every day (as specified by local time) the main module restarts the transport subsystem which includes:</p>
<p>• message processing</p>
<p>• named pipe transport (“NPTransport”)</p>
<p>If the registry/file storage is empty, the module performs a ‘migration’ of hardcoded modules and settings to the storage location. This data is encrypted with a new RSA key (which is also stored in the registry).</p>
<p>The data in the registry is prepended with a 0xC byte header. The maximum size of each registry item is 921,600 bytes; if the maximum size is exceeded, it is split into several items. The format of the header is shown below:</p>
<p>[4:service DWORD][4:chunk index][4:chunk size including header]</p>
<p>Every time the orchestrator module is loaded it validates that the storage area contains the appropriate data and that all of the components can be decrypted and validated. If these checks fail the module reinstalls a configuration from the resource “REINSTALL”.</p>
<p>Pipe Transport</p>
<p>The module generates the pipe name (with the same prefix as the loader); waits for incoming connections; receives data and pushes it to the ‘message processing system’. The module generates the pipe name (with the same prefix as the loader); waits for incoming connections; receives data and pushes it to the ‘message processing system’. Every packet is expected to be at least 6 bytes and contain the following header:      [4:ID][2:command]</p>
<p>List of commands:</p>
<p>1 : new task</p>
<p>2 : update the loader + orchestrator file</p>
<p>4 : send task result</p>
<p>5 : send settings</p>
<p>6 : write results to registry/file storage</p>
<p>7 : enable / disable c2 transport / update status</p>
<p>8 : uninstall</p>
<p>9 : nop</p>
<p>10 : “CMessageProcessingSystem::Receive_NO_CONNECT_TO_GAYZER”; write results to registry</p>
<p>11: write the last connection data ‘{56594FEA-5774-746D-4496-6361266C40D0}’ aka “last connection” storage value</p>
<p>12: “give cache” – write cached commands from the C&amp;C</p>
<p>13: “take cache” – append C&amp;C commands to the cache</p>
<p>Depending on the command, the module returns the results from previously run tasks, the configuration of the module, or a confirmation message.</p>
<p>An example of these tasks is shown below:</p>
<p>• write a file and execute it with CreateProcess() capturing all of the standard output</p>
<p>• update C&amp;C configuration, plugin storage, etc</p>
<p>• update autoruns</p>
<p>• write arbitrary files to the filesystem (“File Upload”)</p>
<p>• read arbitrary files from the filesystem (“File Download”)</p>
<p>• update itself</p>
<p>• uninstall</p>
<p>• push task results to C2 servers</p>
<p>The “LocalTransport manager” handles named pipe communication and identifies if the packet received is designated to the current instance or to someone else (down the route). In the latter scenario the LocalTansport manager re-encrypts the packet, serializes it (again), and pushes the packet via a named pipe on the local network to another hop, (NullSessionPipes). This effectively makes each infected node a packet router.</p>
<p>The Autorun manager subsystem is responsible for tracking the way that the malicious module starts in the system and it maintains several different methods for starting automatically (shown below):</p>
<p>LinkAutorunThe subsystem searches for a LNK file in the target directory, changes the path to “cmd.exe” and the description to ‘ /q /c start “” “%s” &amp;&amp; start “” “%s” ‘</p>
<p>TaskScheduler20AutorunThe subsystem creates the ITaskService (works only on Windows Vista+) and uses the ITaskService interface to create a new task with a logon trigger</p>
<p>StartupAutorunThe subsystem creates a LNK file in %STARTUP%</p>
<p>ScreenSaverAutorunThe subsystem installs as a current screensaver with a hidden window</p>
<p>HiddenTaskAutorunThe subsystem creates the task ITaskScheduler (works only on pre-Vista NT). The task trigger start date is set to the creation date of the Windows directory</p>
<p>ShellAutorunWinlogon registry [HKCU\Software\Microsoft\Windows NT\CurrentVersion\Winlogon] Shell=”explorer.exe, …”</p>
<p>File Uninstallation is done in a discreet manner. The file is filled with zeroes, then renamed to a temporary filename before being deleted</p>
<h3 id="WhiteBear-Transport-library-aka-“Internet-Relations”-“Pipe-Relations”"><a href="#WhiteBear-Transport-library-aka-“Internet-Relations”-“Pipe-Relations”" class="headerlink" title="WhiteBear Transport library (aka “Internet Relations”, “Pipe Relations”)"></a>WhiteBear Transport library (aka “Internet Relations”, “Pipe Relations”)</h3><p>Sample MD5: 19ce5c912768958aa3ee7bc19b2b032c</p>
<p>Type: PE DLL</p>
<p>Linker timestamp:2002.02.05 17:58:22 (GMT)</p>
<p>Linker version: 10.0</p>
<p>Signature“Solid Loop Ldt” UTCTime 15/10/2015 00:00:00 GMT – UTCTime 14/10/2016 23:59:59 GMT</p>
<p>This transport library does not appear on disk in its PE format. It is maintained as encrypted resource 107 in the orchestrator module, then decrypted and loaded by the orchestrator directly into the memory of the target process. This C2 interaction module is independent, once started, it interacts with the orchestrator using its local named pipe.</p>
<p>To communicate with its C2 server, the transport library uses the system user agent or default “Mozilla/4.0 (compatible; MSIE 6.0)”.</p>
<p>Before attempting a connection with its configured C2 server, the module checks if the victim system is connected to Internet by sending HTTP 1.1 GET / requests to the following servers (this process stops after the first successful connection):</p>
<p>• update.microsoft.com</p>
<p>• microsoft.com</p>
<p>• windowsupdate.microsoft.com</p>
<p>• yahoo.com</p>
<p>• google.com</p>
<p>If there is no Internet connection available, the module changes state to, “CANNOT_WORK” and notifies the peer by sending command “7” over the local pipe.</p>
<p>The C2 configuration is obtained from the main module with the command “5”. This checks whether the module complies with the schedule specified in the C2 settings (which includes inactivity time and the interval between connections). The C2 interaction stages have interesting function names and an odd misspelling, indicating that the developer may not be a native English speaker (or may have learned the English language in a British setting):</p>
<p>“InternetRelations::GetInetConnectToGazer”</p>
<p>“InternetRelations::ReceiveMessageFromCentre”</p>
<p>“InternetRelations::SendMessageToCentre”</p>
<p>“PipeRelations::CommunicationTpansportPipe”</p>
<p>The module writes the encrypted log to %TEMP%\CVRG38D9.tmp.cvr The module sends a HTTP 1.0 GET request through a randomly generated path to the C2 server. The server’s reply is expected to have its MD5 checksum appended to the packet. If C2 interaction fails, the module sends the command “10” (“NO_CONNECT_TO_GAYZER”) to the orchestrator.</p>
<h3 id="Unusual-WhiteBear-Encryption"><a href="#Unusual-WhiteBear-Encryption" class="headerlink" title="Unusual WhiteBear Encryption"></a>Unusual WhiteBear Encryption</h3><p>The encryption implemented in the WhiteBear orchestrator is particularly interesting. We note that the resource section is encrypted/decrypted and packed/decompressed with RSA+3DES+BZIP2. This implementation is unique and includes the format of the private key as stored in the resource section. 3DES is present in Sofacy and Duqu2 components, however they are missing in this Microsoft-centric RSA encryption technique. The private key format used in this schema and RSA crypto combination with 3DES is (currently) unique to this threat actor.</p>
<p>The private key itself is stored as a raw binary blob, in a format similar to the one Microsoft code uses in PVK format. This format is not officially documented, but its structures and handling are coded into OpenSSL. This private key value is stored in the orchestrator resources without valid headers. The orchestrator code prepends valid headers and passes the results to OpenSSL functions that parse the blob.</p>
<h3 id="Digital-Code-Signing-Certificate-–-Fictional-Corporation-or-Assumed-Identity"><a href="#Digital-Code-Signing-Certificate-–-Fictional-Corporation-or-Assumed-Identity" class="headerlink" title="Digital Code-Signing Certificate – Fictional Corporation or Assumed Identity?"></a>Digital Code-Signing Certificate – Fictional Corporation or Assumed Identity?</h3><p>Most WhiteBear samples are signed with a valid code signing certificate issued for “Solid Loop Ltd”, a once-registered British organization. Solid Loop is likely a phony front organization or a defunct organization and actors assumed its identity to abuse the name and trust, in order to attain deceptive code-signing digital certificates.</p>
<p><img src="http://img0.tuicool.com/E3eM3iN.png!web" alt=""></p>
<h3 id="WhiteBear-Command-and-Control"><a href="#WhiteBear-Command-and-Control" class="headerlink" title="WhiteBear Command and Control"></a>WhiteBear Command and Control</h3><p>The WhiteBear C2 servers are consistent with long standing Turla infrastructure management practices, so the backdoors callback to a mix of compromised servers and hijacked destination satellite IP hosts. For example, direct, hardcoded Turla satellite IP C2 addresses are shown below:</p>
<p>C2 IP Address               Geolocation                            IP Space Owner</p>
<p>169.255.137[.]203         South Sudan                           IPTEC, VSAT</p>
<p>217.171.86[.]137           Congo                                     Global Broadband Solution, Kinshasa VSAT</p>
<p>66.178.107[.]140           Unknown – Likely Africa          SES/New Skies Satellites</p>
<h3 id="Targeting-and-Victims"><a href="#Targeting-and-Victims" class="headerlink" title="Targeting and Victims"></a>Targeting and Victims</h3><p>WhiteBear targets over the course of a couple years are related to government foreign affairs, international organizations, and later, defense organizations. The geolocation of the incidents are below:</p>
<ul>
<li>Europe</li>
<li>South Asia</li>
<li>Central Asia</li>
<li>East Asia</li>
<li>South America</li>
</ul>
<h2 id="Conclusions"><a href="#Conclusions" class="headerlink" title="Conclusions"></a>Conclusions</h2><p>WhiteBear activity reliant on this toolset seems to have diminished in June 2017. But Turla efforts continue to be run as multiple subgroups and campaigns. This one started targeting diplomatic entities and later included defense related organizations. Infrastructure overlap with other Turla campaigns, code artifacts, and targeting are consistent with past Turla efforts. With this subset of 2016-2017 WhiteBear activity, Turla continues to be one of the most prolific, longstanding, and advanced APT we have researched, and continues to be the subject of much of our research. Links to publicly reported research are below.</p>
<h2 id="Reference-Set"><a href="#Reference-Set" class="headerlink" title="Reference Set"></a>Reference Set</h2><p>Full IOC and powerful YARA rules delivered with private report subscription</p>
<p>Md5</p>
<p>b099b82acb860d9a9a571515024b35f0</p>
<p>19ce5c912768958aa3ee7bc19b2b032c</p>
<p>06bd89448a10aa5c2f4ca46b4709a879</p>
<p>IP</p>
<p>169.255.137[.]203</p>
<p>217.171.86[.]137</p>
<p>66.178.107[.]140</p>
<p>Domain(s)</p>
<p>soligro[.]com – interesting because the domain is used in another Turla operation (KopiLuwak), and is the C2 server for the WhiteBear transport library</p>
<p>mydreamhoroscope[.]com</p>
<h4 id="Example-log-upon-successful-injection"><a href="#Example-log-upon-successful-injection" class="headerlink" title="Example log upon successful injection"></a>Example log upon successful injection</h4><p>|01:58:10:216|.[0208|WinMain ]..</p>
<p>|01:58:14:982|.[0209|WinMain ].******************************************************************************************</p>
<p>|01:58:15:826|.[0212|WinMain ].DATE: 01.01.2017</p>
<p>|01:58:21:716|.[0215|WinMain ].PID=2344.TID=1433.Heaps=3</p>
<p>|01:58:22:701|.[0238|WinMain ].CreateMutex = {521555FA-170C-4AA7-8B2D-159C2F491AA4}</p>
<p>|01:58:25:513|.[0286|GetCurrentUserSID ]._GETSID_METHOD_1_</p>
<p>|01:58:26:388|.[0425|GetUserSidByName ].22 15 1284404594 111</p>
<p>|01:58:27:404|.[0463|GetUserSidByName ].S-1-5-31-4261848827-3118844265-2233733001-1000</p>
<p>|01:58:28:263|.[0471|GetUserSidByName ].</p>
<p>|01:58:29:060|.[0165|GeneratePipeName ].\.\pipe\Winsock2\CatalogChangeListener-5623-b</p>
<p>|01:58:29:763|.[0275|WinMain ].PipeName = \.\pipe\Winsock2\CatalogChangeListener-5623-b</p>
<p>|01:58:30:701|.[0277|WinMain ].Checking for existence…</p>
<p>|01:58:31:419|.[0308|WinMain ].— Pipe is not installed yet</p>
<p>|01:58:32:044|.[0286|GetCurrentUserSID ]._GETSID_METHOD_1_</p>
<p>|01:58:32:841|.[0425|GetUserSidByName ].22 15 1284404594 111</p>
<p>|01:58:33:701|.[0463|GetUserSidByName ].S-1-5-31-4261848827-3118844265-2233733001-1000</p>
<p>|01:58:34:419|.[0471|GetUserSidByName ].</p>
<p>|01:58:35:201|.[0318|WinMain ].Loading…</p>
<p>|01:58:35:763|.[0026|KernelInjector::KernelInjector ].Address of marker: 0x0025F96C and cProcName: 0x0025F860</p>
<p>|01:58:36:513|.[0031|KernelInjector::KernelInjector ].Value of marker = 0xFFFFFEF4</p>
<p>|01:58:37:279|.[0088|KernelInjector::SetMethod ].m_bAntiDEPMethod = 1</p>
<p>|01:58:38:419|.[0564|QueryProcessesInformation ].OK</p>
<p>|01:58:41:169|.[0286|GetCurrentUserSID ]._GETSID_METHOD_1_</p>
<p>|01:58:42:076|.[0425|GetUserSidByName ].22 15 1284404594 111</p>
<p>|01:58:42:748|.[0463|GetUserSidByName ].S-1-5-31-4261848827-3118844265-2233733001-1000</p>
<p>|01:58:43:169|.[0471|GetUserSidByName ].</p>
<p>|01:58:43:701|.[0309|FindProcesses ].dwPID[0] = 1260</p>
<p>|01:58:44:560|.[0345|WinMain ].try to load dll to process (pid=1260))</p>
<p>|01:58:45:013|.[0088|KernelInjector::SetMethod ].m_bAntiDEPMethod = 1</p>
<p>|01:58:45:873|.[0094|KernelInjector::LoadDllToProcess ].MethodToUse = 1</p>
<p>|01:58:46:544|.[0171|KernelInjector::GetProcHandle ].pid = 1260</p>
<p>|01:58:47:279|.[0314|KernelInjector::CopyDllFromBuffer ].Trying to allocate space at address 0x20020000</p>
<p>|01:58:48:404|.[0332|KernelInjector::CopyDllFromBuffer ].IMAGEBASE = 0x20020000.ENTRYPOINT = 0x2002168B</p>
<p>|01:58:48:763|.[0342|KernelInjector::CopyDllFromBuffer ].ANTIDEP INJECT</p>
<p>|01:58:49:419|.[0345|KernelInjector::CopyDllFromBuffer ].Writing memory to target process….</p>
<p>|01:58:49:935|.[0353|KernelInjector::CopyDllFromBuffer ].Calling to entry point….</p>
<p>|01:58:51:185|.[0598|KernelInjector::CallEntryPoint ].CODE = 0x01FA0000, ENTRY = 0x2002168B, CURR = 0x77A465A5, TID = 1132</p>
<p>|01:58:55:544|.[0786|KernelInjector::CallEntryPoint ]._FINISH_ = 1</p>
<p>|01:58:56:654|.[0372|KernelInjector::CopyDllFromBuffer ].CTRLPROC = 0</p>
<p>|01:58:57:607|.[0375|KernelInjector::CopyDllFromBuffer ].+ INJECTED +</p>
<p>|01:58:58:419|.[0351|WinMain ].+++ Load in 1260</p>
<h2 id="References-–-past-Turla-research"><a href="#References-–-past-Turla-research" class="headerlink" title="References – past Turla research"></a>References – past Turla research</h2><p>Source: <a href="http://securelist.com/introducing-whitebear/81638/">http://securelist.com/introducing-whitebear/81638/</a></p>

  </div>
  

 <!-- jsSocials -->
<script src="/jssocials-1.4.0/jssocials.min.js"></script>
<link rel="stylesheet" href="/jssocials-1.4.0/jssocials.css">
<link rel="stylesheet" href="/jssocials-1.4.0/jssocials-theme-flat.css">

<div class="socials-share-btn"></div>
<script>
  if ($) {
    $(document).ready(function(){
      $(".socials-share-btn").jsSocials({
        shares: ["email", "twitter", "facebook", "googleplus", "linkedin", "pinterest", "stumbleupon", "whatsapp"]
      });
    })
  }
</script>


  
<section id="comments">
  <div id="disqus_thread"></div>
</section>
<script>
  var disqus_shortname = 'gmagon';
  var disqus_url = 'https://gmagon.com/blog/2017/08/31/introduction-of-whitebear/index.html';
  var disqus_title = "Introduction of WhiteBear";
  var disqus_config = function(){
    this.language = 'en';
  };
  (function(){
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'https://go.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

  <script src="/js/audios.js"></script>
</article>

          </div>
      
          <aside id="article-toc" role="navigation">
                <div id="article-toc-inner">
                  <strong class="sidebar-title">Contents</strong>
                  <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Technical-Details"><span class="toc-text">Technical Details</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#WhiteBear-Binary-loader"><span class="toc-text">WhiteBear Binary loader</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WhiteBear-Main-module-orchestrator"><span class="toc-text">WhiteBear Main module/orchestrator</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WhiteBear-Transport-library-aka-“Internet-Relations”-“Pipe-Relations”"><span class="toc-text">WhiteBear Transport library (aka “Internet Relations”, “Pipe Relations”)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Unusual-WhiteBear-Encryption"><span class="toc-text">Unusual WhiteBear Encryption</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Digital-Code-Signing-Certificate-–-Fictional-Corporation-or-Assumed-Identity"><span class="toc-text">Digital Code-Signing Certificate – Fictional Corporation or Assumed Identity?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WhiteBear-Command-and-Control"><span class="toc-text">WhiteBear Command and Control</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Targeting-and-Victims"><span class="toc-text">Targeting and Victims</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Conclusions"><span class="toc-text">Conclusions</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reference-Set"><span class="toc-text">Reference Set</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Example-log-upon-successful-injection"><span class="toc-text">Example log upon successful injection</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#References-–-past-Turla-research"><span class="toc-text">References – past Turla research</span></a></li></ol>
                  <a href="#" id="article-toc-top">Back to Top</a>
                </div>
          </aside>
        </div>
      </article>
    </div>
  </div>
</div>

<div class="class-content-wrap">
  <div class="inner">
    <div class="inner-wrap landing-bunting">
      <div class="intro-sub-content-wrap">
      </div>
    </div>
  </div>
</div>



    <footer id="footer" class="landing-bunting font-e3">
  <div class="inner">
    <div id="footer-some-docs">
        <a href="/terms_conditions.html" class="footer-doc-link" >Terms & Conditions</a>
        <a href="/privacy.html" class="footer-doc-link" >Privacy</a>
        <a href="/end-user-license-agreement.html" class="footer-doc-link" >License Agreement</a>
    </div>
    <div id="footer-copyright">
       <a href="" > Copyright &copy; 2017 Gmagon,Inc. All rights reserved. </a>
    </div>
  </div>

  <div class="inner">
    <div id="footer-links">
        
        <a href="https://twitter.com/gmagonshare" class="footer-link" target="_blank" rel="nofollow me noopener noreferrer" ><i class="fa fa-twitter"></i></a>
        
        <a href="https://www.facebook.com/gmagonshare" class="footer-link" target="_blank" rel="nofollow me noopener noreferrer" ><i class="fa fa-facebook"></i></a>
        <a href="https://www.youtube.com/gmagonshare" class="footer-link" target="_blank" rel="nofollow me noopener noreferrer" ><i class="fa fa-youtube"></i></a>
        <a href="https://www.instagram.com/gmagonshare" class="footer-link" target="_blank" rel="nofollow me noopener noreferrer" ><i class="fa fa-instagram"></i></a>
    </div>
  </div>


  <div class="inner">
    <div id="footer-security">
       <p>
          <img src="/asset/images/security/klogo.png">
          <img src="/asset/images/security/mcafee.png">
          <img src="/asset/images/security/cmmodo_scanned.png">
          <img src="/asset/images/security/softonic_tested.png">
          <img src="/asset/images/security/tested_by_sucuri.png">
          <img src="/asset/images/security/norton.png">
          <img src="/asset/images/security/eset_logo.png">
       </p>
    </div>
  </div>




</footer>

  </div>
  <div id="mobile-nav-dimmer"></div>
  <nav id="mobile-nav">
  <div id="mobile-nav-inner">
    <ul id="mobile-nav-list">
      <a href="/" class="mobile-nav-link ">Home</a><a href="/products/" class="mobile-nav-link ">Products</a><a href="/guide/" class="mobile-nav-link ">Guide</a><a href="/support/" class="mobile-nav-link ">Support</a><a href="/blog/" class="mobile-nav-link ">Blog</a>
      
    </ul>
    
  </div>
  <div id="mobile-lang-select-wrap">
    <span id="mobile-lang-select-label"><i class="fa fa-globe"></i><span>English</span></span>
    <select id="mobile-lang-select" data-canonical="">
      
        <option value="en" selected>English</option>
      
    </select>
  </div>
</nav>

  <!-- Scripts -->
<script src="/build/js/main-8277743eaa.js"></script>
<!-- <script src="https://cdn.jsdelivr.net/retinajs/1.3.0/retina.min.js" async></script> -->

<!-- totop -->
<div id="gmagon_totop" style="position:fixed;bottom:150px;right:30px;cursor: pointer;">
  <a title="Back to top"><img src="/asset/images/scroll-up.png"/></a>
</div>
<script src="/js/totop.js"></script>





<!-- Google Analytics -->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-99314951-1', 'auto');
  ga('send', 'pageview');
</script>


</body>
</html>