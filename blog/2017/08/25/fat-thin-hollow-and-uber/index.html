<!DOCTYPE html>
<html lang="en">
<head prefix="og: http://ogp.me/ns#">
  <meta charset="utf-8">

  <title>Fat, Thin, Hollow, and Uber - Gmagon Software - handy and professional Mac apps.</title>

  <meta http-equiv="X-UA-Compatible" content="IE=8; IE=9; IE=Edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta name="robots" content="noodp" />
  <meta name="keywords" content="Fat, Thin, Hollow, and Uber" />
  <meta name="description" content="Fat, Thin, Hollow, and Uber" />

  <!-- Custom config og:image -->


  <!-- Open Graph -->
<meta name="description" content="Fat, Thin, Hollow, and Uber - Gmagon Software - handy and professional Mac apps.">
<meta property="og:type" content="apps">
<meta property="og:title" content="Fat, Thin, Hollow, and Uber - Gmagon Software - handy and professional Mac apps.">
<meta property="og:url" content="https://gmagon.com/blog/2017/08/25/fat-thin-hollow-and-uber/index.html">
<meta property="og:site_name" content="Fat, Thin, Hollow, and Uber - Gmagon Software - handy and professional Mac apps.">
<meta property="og:description" content="Fat, Thin, Hollow, and Uber - Gmagon Software - handy and professional Mac apps.">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://img1.tuicool.com/YfmMFja.png!web">
<meta property="og:image" content="http://img2.tuicool.com/VJ3E3ya.png!web">
<meta property="og:updated_time" content="2017-08-25T08:28:07.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Fat, Thin, Hollow, and Uber - Gmagon Software - handy and professional Mac apps.">
<meta name="twitter:description" content="Fat, Thin, Hollow, and Uber - Gmagon Software - handy and professional Mac apps.">
<meta name="twitter:image" content="http://img1.tuicool.com/YfmMFja.png!web">
<meta name="twitter:site" content="gmagonshare">
<meta property="fb:admins" content="432634277117208">
<meat name="twitter:url" content="https://gmagon.com/blog/2017/08/25/fat-thin-hollow-and-uber/index.html">



  <!-- algolia_config -->
  
  
  <!-- Canonical links -->
  <link rel="canonical" href="https://gmagon.com/blog/2017/08/25/fat-thin-hollow-and-uber/index.html">

  <!-- Alternative links -->
  

  <!-- Icon -->
  <link rel="apple-touch-icon" sizes="57x57" href="/icon/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icon/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icon/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icon/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icon/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icon/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icon/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icon/apple-touch-icon-152x152.png">
  <link rel="icon" type="image/png" href="/icon/favicon-196x196.png" sizes="196x196">
  <link rel="icon" type="image/png" href="/icon/favicon-160x160.png" sizes="160x160">
  <link rel="icon" type="image/png" href="/icon/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/icon/favicon-16x16.png" sizes="16x16">
  <link rel="icon" type="image/png" href="/icon/favicon-32x32.png" sizes="32x32">
  <meta name="msapplication-TileColor" content="#2f83cd">
  <meta name="msapplication-TileImage" content="/icon/mstile-144x144.png">

  <!-- CSS -->
  <link rel="stylesheet" href="/build/css/navy-a395c8a81d.css">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  
  <!-- jQuery -->
  <script src="/js/jquery/jquery-3.2.1.min.js"></script>
<script src="/js/jquery/jquery-migrate-1.4.1.min.js"></script>



  <!-- ForPostLayout -->
  
    
    
  
  <!-- endForPostLayout -->

  <!-- RSS -->
  <link rel="alternate" href="/atom.xml" title="Gmagon Software - handy and professional Mac apps.">

  <!-- algolia_search -->
  <script src="/assets/algolia/algoliasearchLite.min.js" async></script>

  <!-- Github Button -->
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  <!-- Utils -->
<script src="/js/utils.js"></script>
</head>

<body>
  <div id="container">
    <header id="header">
  <div class="wrapper">
    <div id="header-inner" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Gmagon Software - handy and professional Mac apps.</a>
        <span>gmagon </span>
      </h1>
      <nav id="main-nav">
        <a href="/" class="main-nav-link ">Home</a><a href="/products/" class="main-nav-link ">Products</a><a href="/guide/" class="main-nav-link ">Guide</a><a href="/support/" class="main-nav-link ">Support</a><a href="/blog/" class="main-nav-link ">Blog</a>
        <div id="search-input-wrap">
          <a href="/search/" class="text-decoration-none">
            <div id="search-input-icon">
              <i class="fa fa-search"></i>
            </div>
          </a>
        </div>
      </nav>
      <div id="lang-select-wrap">
        <label id="lang-select-label"><i class="fa fa-globe"></i><span>English</span></label>
        <select id="lang-select" data-canonical="">
          
            <option value="en" selected>English</option>
          
        </select>
      </div>
      <a id="mobile-nav-toggle">
        <span class="mobile-nav-toggle-bar"></span>
        <span class="mobile-nav-toggle-bar"></span>
        <span class="mobile-nav-toggle-bar"></span>
      </a>
    </div>
  </div>  
</header>
<div class="hide-wrap-head-top"></div>

    <div class="class-content-wrap">
  <div class="inner">
    <div class="inner-wrap fill-bunting font-e3">
      <h2 id="banner-title"> Fat, Thin, Hollow, and Uber </h2>
      <div id="banner-start">
        <a class="btn btn-static-secondary btn-shadow" href="https://gitter.im/Gmagon/support" ttarget="_blank" rel="nofollow me noopener noreferrer" >Need help?</a>
      </div>
    </div>
  </div>
</div>

<div class="class-content-wrap">
  <div class="wrapper">
    <div class="inner">
      <article class="article-container" itemscope itemtype="http://schema.org/Article">
        <div class="article-inner">
          <div class="article">
          <div class="hide-wrap-head-top"></div>
<article class="article post" itemscope itemtype="http://schema.org/Article">
  <header class="article-header">
    
      <h1 class="article-title" itemprop="name">Fat, Thin, Hollow, and Uber</h1>
    
    <a href="/blog/2017/08/25/fat-thin-hollow-and-uber/" class="article-date"><time datetime="2017-08-25T00:00:00.000Z">2017-08-25</time></a>
  </header>
  <div class="article-content" itemprop="articleBody">
    <p><img src="http://img1.tuicool.com/YfmMFja.png!web" alt=""></p>
<p>“I used <a href="http://wildfly-swarm.io/">WildFly Swarm</a>to shrink my app from<strong>45 megabytes</strong>to only<strong>2243 bytes</strong>.”</p>
<p>I was recently playing around with various techniques for packaging Java microservices and running on OpenShift using various runtimes and frameworks to illustrate their differences (WildFly Swarm vs. WildFly, Spring Boot vs. the world, etc). Around the same time as I was doing this an internal email list thread ignited discussing some of the differences and using terms like Uber JARs, Thin WARs, Skinny WARs, and a few others. Some folks were highlighting the pros and cons of each, especially the benefits of the thin WAR approach when combined with docker image layers.</p>
<p>And I thought to myself: isn’t this what everyone is already doing? Do developers really have to think about this stuff? But before I get into that, I want to define the various terms I’ve heard and at least get it straight in my own head.</p>
<h2 id="The-Qualifiers-in-increasing-order-of-logical-size"><a href="#The-Qualifiers-in-increasing-order-of-logical-size" class="headerlink" title="The Qualifiers (in increasing order of logical size)"></a>The Qualifiers (in increasing order of logical size)</h2><p><img src="http://img2.tuicool.com/VJ3E3ya.png!web" alt=""></p>
<ul>
<li><strong>Skinny</strong><br>– Contains ONLY the bits you literally type into your code editor, and NOTHING else.</li>
<li><strong>Thin</strong><br>– Contains all of the above PLUS the app’s direct dependencies of your app (db drivers, utility libraries, etc).</li>
<li><strong>Hollow</strong><br>– The inverse of Thin – Contains only the bits needed to run your app but does NOT contain the app itself. Basically a pre-packaged “app server” to which you can later deploy your app, in the same style as traditional Java EE app servers, but with important differences, we’ll get to later.</li>
<li><strong>Fat/Uber</strong><br>– Contains the bit you literally write yourself PLUS the direct dependencies of your app PLUS the bits needed to run your app “on its own”.</li>
</ul>
<p>Now let’s define how the qualifiers map to the world of Java applications and package types (JAR, WAR, etc).</p>
<h3 id="Fat-Uber-JAR"><a href="#Fat-Uber-JAR" class="headerlink" title="Fat/Uber JAR"></a>Fat/Uber JAR</h3><p><a href="http://maven.apache.org/">Maven</a>and in particular<a href="https://projects.spring.io/spring-boot/">Spring Boot</a>popularized this well-known approach to packaging, which includes everything needed to run the whole app on a standard Java Runtime environment (i.e. so you can run the app with java -jar myapp.jar). The amount of extra runtime stuff included in the Uberjar (and its file size) depends on the framework and runtime features your app uses.</p>
<h3 id="Thin-WAR"><a href="#Thin-WAR" class="headerlink" title="Thin WAR"></a>Thin WAR</h3><p>If you’re a Java EE developer, chances are you’re already doing this. It is what you have been doing for<a href="http://docs.oracle.com/javaee/1.2.1/devguide/html/Overview5.html#10106">over a decade</a>, so congratulations you’re still cool! A thin WAR is a Java EE web application that only contains the web content and business logic you wrote, along with 3rd-party dependencies. It does not contain anything provided by the Java EE runtime, hence it’s “thin” but it cannot run “on its own” – it must be deployed to a Java EE app server or Servlet container that contains the “last mile” of bits needed to run the app on the JVM.</p>
<h3 id="Thin-JAR"><a href="#Thin-JAR" class="headerlink" title="Thin JAR"></a>Thin JAR</h3><p>Same as a Thin WAR, except using the JAR packaging format. Typically, this is used by specialized applications/plugin architectures that use the JAR packaging format for its purpose-built plugin or runtime artifacts. For example, the .kjar format from<a href="https://www.drools.org/">Drools</a>.</p>
<h3 id="Skinny-WAR"><a href="#Skinny-WAR" class="headerlink" title="Skinny WAR"></a>Skinny WAR</h3><p>While less well known than its brethren, a skinny WAR is thinner than a Thin WAR because it does not include any of the 3rd-party libraries that the app depends on. It ONLY contains the (byte) code that you as the developer literally type in your editor. This makes a lot of sense in the docker world of layered container images, where layer size is important for DevOps sanity, and<a href="http://adam-bien.com/roller/abien/">Adam Bien</a>has done an awesome job demonstrating and explaining this. More on this later.</p>
<h3 id="Skinny-JAR"><a href="#Skinny-JAR" class="headerlink" title="Skinny JAR"></a>Skinny JAR</h3><p>The same as a Skinny WAR, except using JAR packaging and frameworks built around it such as WildFly Swarm and Spring Boot. This also makes a ton of sense for CI/CD sanity (and your AWS bill) –<a href="http://product.hubspot.com/blog/the-fault-in-our-jars-why-we-stopped-building-fat-jars">just ask Hubspot</a>. Here you take a Thin WAR and remove all the 3rd-party dependencies. You’re left with the smallest atomic unit of app (attempting to go smaller sounds like a terrible idea but with Java 9/JPMS is might be possible), and it must be deployed to a runtime that is expecting it AND has all of the other needed bits to run the app (such as a Hollow JAR)</p>
<h3 id="Hollow-JAR"><a href="#Hollow-JAR" class="headerlink" title="Hollow JAR"></a>Hollow JAR</h3><p>This is a Java application runtime that contains “just enough” app server to run applications but does not contain any applications itself. It can run on its own but isn’t that useful when running on its own since it doesn’t contain applications and won’t do anything other than initializing itself. Some projects like WildFly Swarm allow you to customize how much is “just enough” while others (like<a href="https://www.payara.fish/payara_micro">Paraya Micro</a>, or<a href="http://www.tomitribe.com/products/apache-tomcat-and-tomee/">TomEE</a>) provide pre-built distributions of popular combinations of runtime components, such as those defined by<a href="http://microprofile.io/">Eclipse MicroProfile</a>.</p>
<h2 id="The-other-combinations"><a href="#The-other-combinations" class="headerlink" title="The other combinations"></a>The other combinations</h2><ul>
<li>Hollow WAR – In theory you could package some kind app to run within another app server and then deploy apps to that inner layer. Good luck with that!</li>
<li>Fat/Uber WAR – Doesn’t make sense with the general idea of Fat/Ubers being runnable with java-jar.</li>
<li>EAR files – by definition an EAR file cannot be hollow, fat, or skinny, so all you can create is a Thin EAR (which is what it is already, by definition). Move along, nothing to see here, except that EAR files<br><a href="http://maven.apache.org/plugins/maven-war-plugin/examples/skinny-wars.html">could be the vehicle</a><br>that carries dependencies for skinny WARs within the EAR.</li>
</ul>
<h2 id="Why-bother"><a href="#Why-bother" class="headerlink" title="Why bother?"></a>Why bother?</h2><p>The rise of for-rent computing and the popularity of devops processes, Linux containers, and microservice architectures has made app footprint (the number of bytes that make up your app) important again. When you’re deploying to dev, test, and production environments multiple times a day (sometimes hundreds per hour or even<a href="https://www.infoq.com/news/2014/06/everything-google-containers">2 billion times a week</a>), minimizing the size of your app can have a huge impact on overall devops efficiency, and your operational sanity. You don’t have to minimize the lines of code in your app, but you should reduce the number of times your app and its app dependencies have to pass across a network, move onto or off of a disk, or be processed by a program. That means breaking your app into different packaged parts so that they can be properly separated and treated as such (and even versioned if you so choose).</p>
<p>With cloud native microservices, this means using layered Linux container images. If you can separate your app’s components into different layers, putting the most frequently changing parts of your app on “top” and the least frequently changing parts on the “bottom”, then every time you re-construct a new version of your app you are in reality only touching the highest levels. Saving time across the board for storage, transport, and processing of the new version of your app.</p>
<h2 id="Great-Just-tell-me-which-one-to-use"><a href="#Great-Just-tell-me-which-one-to-use" class="headerlink" title="Great. Just tell me which one to use!"></a>Great. Just tell me which one to use!</h2><p>It depends. The pros/cons of each have been discussed by others [<a href="http://andymrb.blogspot.co.uk/2017/03/uber-jars-vs-thin-wars-pros-and-cons.html">here</a>,<a href="https://www.reddit.com/r/java/comments/36nt73/war_vs_containerless_spring_boot_etc/">here</a>and<a href="https://blog.codecentric.de/en/2015/06/real-jars-have-curves/">here</a>]. Fat/Uber JARs are attractive due to their portability, ease of execution in IDEs and its all-you-need-is-a-JRE characteristic. But the more you can separate the layers (into skinny/thin), the more you will save on network/disk/cpu further down the line. There’s also the added benefit of being able to patch all the layers independently, for example, to subscribe and quickly distribute fixes for security vulnerabilities to all of your running apps). So, you have to decide amongst the tradeoffs.</p>
<h2 id="Example-WildFly-Swarm"><a href="#Example-WildFly-Swarm" class="headerlink" title="Example: WildFly Swarm"></a>Example: WildFly Swarm</h2><p>WildFly Swarm is a mechanism for packaging Java applications that contain “just enough” functionality to run the app. It has an abstraction called a Fraction, each of which embodies some functionality that apps need. You can select which Fractions you need, and package only those fractions along with your app to produce a minimized and specialized runnable image for your app.</p>
<p>WildFly Swarm has the ability to create many of the above types of packaged apps. Let’s look at what it can do and the resulting size(s) of various packaging options, and how it applies in the world of layered Linux container images. We’ll start with the Fat/Uber JAR and work our way down.<a href="https://github.com/jamesfalkner/wfswarm-packaging-demo">Grab the code</a>and follow along:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ git clone https://github.com/jamesfalkner/wfswarm-packaging-demo</div></pre></td></tr></table></figure>
<h2 id="Fat-Uber-JARs"><a href="#Fat-Uber-JARs" class="headerlink" title="Fat/Uber JARs"></a>Fat/Uber JARs</h2><p>The sample app is a simple JAX-RS endpoint that returns a message. It has one direct dependency on Joda Time, which we’ll use later on. For now, let’s make a Fat JAR (which is the default mode of WildFly Swarm) using the code in the fat-thin/ folder:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ cd fat-thin; mvn clean package</div><div class="line">$ du -hs target/*.jar</div><div class="line">45M target/weight-1.0-swarm.jar</div></pre></td></tr></table></figure>
<p>You can test it out with<code>java -jar target/weight-1.0-swarm.jar</code>and then<code>curl http://localhost:8080/api/hello</code>in a separate terminal window.</p>
<p>Not bad – 45M in size for a completely self-contained FAT jar. You could stuff this in a docker image layer everytime you rebuild, but that 45M will grow as you actually implement a real-world app. Let’s see if we can do better.</p>
<h2 id="Thin-WARs"><a href="#Thin-WARs" class="headerlink" title="Thin WARs"></a>Thin WARs</h2><p>As part of the above build of the Fat JAR, WildFly Swarm also created a Thin WAR so no rebuild is necessary. Take a look at the Thin WAR:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ du -hs target/*.war</div><div class="line">512K target/weight-1.0.war</div></pre></td></tr></table></figure>
<p>Now we’re getting somewhere. This 512K Thin WAR could be deployed to any app server (such as WildFly itself). So if you stuff this much smaller file into your upper docker layers while your rarely-changed app server lives in a lower layer (as<a href="http://adam-bien.com/roller/abien/">Adam Bien</a><a href="http://www.adam-bien.com/roller/abien/entry/think_wars_high_productivity_and">demos</a><a href="http://www.adam-bien.com/roller/abien/entry/launching_java_ee_thin_wars">multiple</a><a href="http://www.adam-bien.com/roller/abien/entry/java_ee_7_thin_wars">times</a>), you’ll save quite a bit of time and energy during multiple builds. Let’s keep going.</p>
<h2 id="Skinny-WARs"><a href="#Skinny-WARs" class="headerlink" title="Skinny WARs"></a>Skinny WARs</h2><p>You may have noticed in the demo app that it’s super-simple – only a few lines of code. So why does it take 512K to hold it? Most of the 512M in the Thin WAR is taken up by our direct dependencies – in this case, the<a href="http://www.joda.org/joda-time/">Joda Time library</a>:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">% unzip -l target/*.war</div><div class="line">Archive: target/weight-1.0.war</div><div class="line">Length Date Time Name</div><div class="line">-------- ---- ---- ----</div><div class="line">0 08-03-17 01:14 META-INF/</div><div class="line">134 08-03-17 01:14 META-INF/MANIFEST.MF</div><div class="line">0 08-03-17 01:14 WEB-INF/</div><div class="line">0 08-03-17 01:14 WEB-INF/classes/</div><div class="line">0 08-03-17 01:14 WEB-INF/classes/com/</div><div class="line">0 08-03-17 01:14 WEB-INF/classes/com/test/</div><div class="line">0 08-03-17 01:14 WEB-INF/classes/com/test/rest/</div><div class="line">0 08-03-17 01:14 WEB-INF/lib/</div><div class="line">746 08-03-17 01:14 WEB-INF/classes/com/test/rest/HelloEndpoint.class</div><div class="line">402 08-03-17 01:14 WEB-INF/classes/com/test/rest/RestApplication.class</div><div class="line">634048 08-03-17 01:14 WEB-INF/lib/joda-time-2.9.9.jar  &lt;------ This one</div><div class="line">0 08-03-17 01:14 META-INF/maven/</div><div class="line">0 08-03-17 01:14 META-INF/maven/com.test/</div><div class="line">0 08-03-17 01:14 META-INF/maven/com.test/weight/</div><div class="line">2954 08-03-17 01:14 META-INF/maven/com.test/weight/pom.xml</div><div class="line">97 08-03-17 01:14 META-INF/maven/com.test/weight/pom.properties</div><div class="line">-------- -------</div><div class="line">638381 16 files</div></pre></td></tr></table></figure>
<p>If we continue to add direct dependencies (like database drivers and other things virtually every production app will need), our Thin WAR will also grow and grow in size over time. While 512K isn’t bad, we can do much better.</p>
<h3 id="Skinny-WAR-Removing-direct-dependencies"><a href="#Skinny-WAR-Removing-direct-dependencies" class="headerlink" title="Skinny WAR: Removing direct dependencies"></a>Skinny WAR: Removing direct dependencies</h3><p>With Maven you could remove the direct dependency from the resulting Thin WAR by declaring it has to be provided, meaning that the runtime (in this case, WildFly) is expected to provide that dependency. Due to the nature of app servers and WildFly’s modular class loader, to make WildFly provide this dependency when your app is deployed to it you would need to create a custom<a href="https://jboss-modules.github.io/jboss-modules/manual/">JBoss Module</a>definition in your Wildfly configuration and declare a dependency on that module in your app.</p>
<p>WildFly Swarm provides a better way that does not require that you touch the app server bits at all. We can create a custom module called a Fraction. Fractions are first-class citizens in WildFly Swarm, and it has special logic which links code inside of Fractions with application code at runtime. By doing this, our application truly has no dependencies and becomes a Skinny WAR.</p>
<p>I’ve created a fraction to house the Joda Time library in the<code>joda-fraction/</code>folder within the example app’s source. Let’s build it and copy it to our Maven repo for later referencing:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ cd joda-fraction; mvn clean package install</div><div class="line"></div><div class="line">[INFO] --- maven-install-plugin:2.4:install (default-install) @ joda ---</div><div class="line">[INFO] Installing /Users/jfalkner/ws/fat/joda-fraction/target/joda-1.2.jar to /Users/jfalkner/.m2/repository/com/jhf/joda/1.2/joda-1.2.jar</div><div class="line">[INFO] Installing /Users/jfalkner/ws/fat/joda-fraction/pom.xml to /Users/jfalkner/.m2/repository/com/jhf/joda/1.2/joda-1.2.pom</div><div class="line">[INFO] ------------------------------------------------------------------------</div><div class="line">[INFO] BUILD SUCCESS</div><div class="line">[INFO] ------------------------------------------------------------------------</div><div class="line">Now that the fraction is built, rebuild the skinny version of the app (in the skinny/ folder):</div></pre></td></tr></table></figure>
<p>Now that the fraction is built, rebuild the skinny version of the app (in the skinny/ folder):</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ cd ../skinny; mvn clean package</div><div class="line">$ ls -l target/*.war</div><div class="line">-rw-r--r-- 1 jfalkner staff 2243 Aug 3 01:45 target/weight-1.0.war</div></pre></td></tr></table></figure>
<p>Now we’re getting somewhere! Our Skinny WAR is<strong>2243 bytes</strong>. That’s as small as it gets, as it literally only contains our code:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ unzip -l target/*.war</div><div class="line">Archive: target/weight-1.0.war</div><div class="line">Length Date Time Name</div><div class="line">-------- ---- ---- ----</div><div class="line">99 08-03-17 01:45 META-INF/MANIFEST.MF</div><div class="line">0 08-03-17 01:45 META-INF/</div><div class="line">0 08-03-17 01:45 WEB-INF/</div><div class="line">0 08-03-17 01:45 WEB-INF/classes/</div><div class="line">0 08-03-17 01:45 WEB-INF/classes/com/</div><div class="line">0 08-03-17 01:45 WEB-INF/classes/com/test/</div><div class="line">0 08-03-17 01:45 WEB-INF/classes/com/test/rest/</div><div class="line">0 08-03-17 01:45 WEB-INF/lib/</div><div class="line">402 08-03-17 01:45 WEB-INF/classes/com/test/rest/RestApplication.class</div><div class="line">746 08-03-17 01:45 WEB-INF/classes/com/test/rest/HelloEndpoint.class</div><div class="line">-------- -------</div><div class="line">1247 10 files</div></pre></td></tr></table></figure>
<p>It’s_completely unusable_on its own, however. It requires not only an app server with JAX-RS support but also a server that can provide our direct Joda Time dependency. WildFly Swarm provides another facility to create such a server runtime that will contain just enough app server PLUS our newly separated Joda Time dependency. It’s called a<em>Hollow JAR</em>.</p>
<h2 id="Hollow-JARs"><a href="#Hollow-JARs" class="headerlink" title="Hollow JARs"></a>Hollow JARs</h2><p>To build a hollow JAR suitable for running our sample app, we can use a WildFly Swarm property to instruct the Maven plugin to build it:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ mvn clean package -Dswarm.hollow=true</div><div class="line">$ du -hs target/*.jar target/*.war</div><div class="line">44M target/weight-1.0-hollow-swarm.jar</div><div class="line">4.0K target/weight-1.0.war</div></pre></td></tr></table></figure>
<p>There’s the hollow server weighing in at 44M and our skinny WAR at 2243 bytes (the Linux<a href="http://www.unix.com/man-page/All/1b/du/">du utility</a>reports disk space allocated in units of the filesystem’s block size, which is 4K on my system, but rest assured the skinny WAR is indeed 2243 bytes and when transferred over a network only 2243 bytes will be sent).</p>
<p>Now you can stuff the hollow JAR into a Linux container layer, and then stuff the skinny WAR on top. When you rebuild your project with new code, assuming you’re not adding more dependencies to the app server, only your skinny WAR will be rebuilt, saving time, disk space, trees, and your sanity during those 2 billion container rebuilds you do each week.</p>
<p>To run your skinny app and verify it still works in conjunction with the hollow server you’ve just created:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ java -jar target/weight-1.0-hollow-swarm.jar target/weight-1.0.war</div></pre></td></tr></table></figure>
<p>And in another terminal:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ curl http://localhost:8080/api/hello</div><div class="line">hello, the date is 2017-08-03</div></pre></td></tr></table></figure>
<h2 id="What-about-Spring-Boot"><a href="#What-about-Spring-Boot" class="headerlink" title="What about Spring Boot?"></a>What about Spring Boot?</h2><p>Spring Boot’s out of the box defaults are also to build a fat jar, so let’s have a look at the example Boot app:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ cd spring-boot-fat; mvn clean package</div><div class="line">$ du -hs target/*.jar</div><div class="line">14M target/greeting-spring-boot.jar</div></pre></td></tr></table></figure>
<p>Much better than WildFly Swarm’s 45M. But where do we go from here? It’s still 14M for a hello world app.</p>
<p>While it is possible to separate app code from Spring code and produce an effect much like WildFly Swarm’s hollow JAR / skinny WAR duo, it requires you to violate the<a href="https://en.wikipedia.org/wiki/Fourth_wall">Fourth wall</a>and know of the internals of the Spring Boot Uberjar, and write scripted surgery on the resulting FAT jar to split its contents along the app boundary defined by Boot. The result is a very tightly coupled and non-portable app and app server, with virtually no hope of upgrading and no ability to deploy anything to it other than the app from which it sprang. Runnable hollow JARs are not considered a first-class citizen in the Spring world.</p>
<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>We shrank our app from 45M → 512K → 2243 bytes using<a href="http://wildfly-swarm.io/">WildFly Swarm</a>. With this approach, we can separate our app from its runtime dependencies, and put them in separate Linux container image layers. This will make your CI/CD pipelines fast, but also make your developers faster at edit/build/test and provide assurance that you are testing with the same bits that will land in production. Win-win-win in my book.</p>
<p>Source: <a href="http://www.tuicool.com/articles/hit/ZbEf2iI">https://developers.redhat.com/blog/2017/08/24/the-skinny-on-fat-thin-hollow-and-uber/</a></p>

  </div>
  

 <!-- jsSocials -->
<script src="/jssocials-1.4.0/jssocials.min.js"></script>
<link rel="stylesheet" href="/jssocials-1.4.0/jssocials.css">
<link rel="stylesheet" href="/jssocials-1.4.0/jssocials-theme-flat.css">

<div class="socials-share-btn"></div>
<script>
  if ($) {
    $(document).ready(function(){
      $(".socials-share-btn").jsSocials({
        shares: ["email", "twitter", "facebook", "googleplus", "linkedin", "pinterest", "stumbleupon", "whatsapp"]
      });
    })
  }
</script>


  
<section id="comments">
  <div id="disqus_thread"></div>
</section>
<script>
  var disqus_shortname = 'gmagon';
  var disqus_url = 'https://gmagon.com/blog/2017/08/25/fat-thin-hollow-and-uber/index.html';
  var disqus_title = "Fat, Thin, Hollow, and Uber";
  var disqus_config = function(){
    this.language = 'en';
  };
  (function(){
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'https://go.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

  <script src="/js/audios.js"></script>
</article>

          </div>
      
          <aside id="article-toc" role="navigation">
                <div id="article-toc-inner">
                  <strong class="sidebar-title">Contents</strong>
                  <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#The-Qualifiers-in-increasing-order-of-logical-size"><span class="toc-text">The Qualifiers (in increasing order of logical size)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Fat-Uber-JAR"><span class="toc-text">Fat/Uber JAR</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Thin-WAR"><span class="toc-text">Thin WAR</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Thin-JAR"><span class="toc-text">Thin JAR</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Skinny-WAR"><span class="toc-text">Skinny WAR</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Skinny-JAR"><span class="toc-text">Skinny JAR</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hollow-JAR"><span class="toc-text">Hollow JAR</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#The-other-combinations"><span class="toc-text">The other combinations</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Why-bother"><span class="toc-text">Why bother?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Great-Just-tell-me-which-one-to-use"><span class="toc-text">Great. Just tell me which one to use!</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-WildFly-Swarm"><span class="toc-text">Example: WildFly Swarm</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Fat-Uber-JARs"><span class="toc-text">Fat/Uber JARs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Thin-WARs"><span class="toc-text">Thin WARs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Skinny-WARs"><span class="toc-text">Skinny WARs</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Skinny-WAR-Removing-direct-dependencies"><span class="toc-text">Skinny WAR: Removing direct dependencies</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hollow-JARs"><span class="toc-text">Hollow JARs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#What-about-Spring-Boot"><span class="toc-text">What about Spring Boot?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Summary"><span class="toc-text">Summary</span></a></li></ol>
                  <a href="#" id="article-toc-top">Back to Top</a>
                </div>
          </aside>
        </div>
      </article>
    </div>
  </div>
</div>

<div class="class-content-wrap">
  <div class="inner">
    <div class="inner-wrap landing-bunting">
      <div class="intro-sub-content-wrap">
      </div>
    </div>
  </div>
</div>



    <footer id="footer" class="landing-bunting font-e3">
  <div class="inner">
    <div id="footer-some-docs">
        <a href="/terms_conditions.html" class="footer-doc-link" >Terms & Conditions</a>
        <a href="/privacy.html" class="footer-doc-link" >Privacy</a>
        <a href="/end-user-license-agreement.html" class="footer-doc-link" >License Agreement</a>
    </div>
    <div id="footer-copyright">
       <a href="" > Copyright &copy; 2017 Gmagon,Inc. All rights reserved. </a>
    </div>
    <div id="footer-links">
      
      <a href="https://twitter.com/gmagonshare" class="footer-link" target="_blank" rel="nofollow me noopener noreferrer" ><i class="fa fa-twitter"></i></a>
      
      <a href="https://www.facebook.com/gmagonshare" class="footer-link" target="_blank" rel="nofollow me noopener noreferrer" ><i class="fa fa-facebook"></i></a>
      <a href="https://www.youtube.com/gmagonshare" class="footer-link" target="_blank" rel="nofollow me noopener noreferrer" ><i class="fa fa-youtube"></i></a>
      <a href="https://www.instagram.com/gmagonshare" class="footer-link" target="_blank" rel="nofollow me noopener noreferrer" ><i class="fa fa-instagram"></i></a>
    </div>
  </div>

  <div id="footer-security">
       <p>
          <img src="/asset/images/security/klogo.png">
          <img src="/asset/images/security/mcafee.png">
          <img src="/asset/images/security/cmmodo_scanned.png">
          <img src="/asset/images/security/softonic_tested.png">
          <img src="/asset/images/security/tested_by_sucuri.png">
          <img src="/asset/images/security/norton.png">
          <img src="/asset/images/security/eset_logo.png">
       </p>
    </div>
</footer>

  </div>
  <div id="mobile-nav-dimmer"></div>
  <nav id="mobile-nav">
  <div id="mobile-nav-inner">
    <ul id="mobile-nav-list">
      <a href="/" class="mobile-nav-link ">Home</a><a href="/products/" class="mobile-nav-link ">Products</a><a href="/guide/" class="mobile-nav-link ">Guide</a><a href="/support/" class="mobile-nav-link ">Support</a><a href="/blog/" class="mobile-nav-link ">Blog</a>
      
    </ul>
    
  </div>
  <div id="mobile-lang-select-wrap">
    <span id="mobile-lang-select-label"><i class="fa fa-globe"></i><span>English</span></span>
    <select id="mobile-lang-select" data-canonical="">
      
        <option value="en" selected>English</option>
      
    </select>
  </div>
</nav>

  <!-- Scripts -->
<script src="/build/js/main-8277743eaa.js"></script>
<!-- <script src="https://cdn.jsdelivr.net/retinajs/1.3.0/retina.min.js" async></script> -->

<!-- totop -->
<div id="gmagon_totop" style="position:fixed;bottom:150px;right:30px;cursor: pointer;">
  <a title="Back to top"><img src="/asset/images/scroll-up.png"/></a>
</div>
<script src="/js/totop.js"></script>





<!-- Google Analytics -->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-99314951-1', 'auto');
  ga('send', 'pageview');
</script>


</body>
</html>