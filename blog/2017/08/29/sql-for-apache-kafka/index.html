<!DOCTYPE html>
<html lang="en">
<head prefix="og: http://ogp.me/ns#">
  <meta charset="utf-8">

  <title>Open Source Streaming SQL for Apache Kafka - Gmagon Software - handy and professional Mac apps.</title>

  <meta http-equiv="X-UA-Compatible" content="IE=8; IE=9; IE=Edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta name="robots" content="noodp" />
  <meta name="keywords" content="Open Source Streaming SQL for Apache Kafka" />
  <meta name="description" content="Open Source Streaming SQL for Apache Kafka" />

  <!-- Custom config og:image -->


  <!-- Open Graph -->
<meta name="description" content="Open Source Streaming SQL for Apache Kafka - Gmagon Software - handy and professional Mac apps.">
<meta property="og:type" content="apps">
<meta property="og:title" content="Open Source Streaming SQL for Apache Kafka - Gmagon Software - handy and professional Mac apps.">
<meta property="og:url" content="https://gmagon.com/blog/2017/08/29/sql-for-apache-kafka/index.html">
<meta property="og:site_name" content="Open Source Streaming SQL for Apache Kafka - Gmagon Software - handy and professional Mac apps.">
<meta property="og:description" content="Open Source Streaming SQL for Apache Kafka - Gmagon Software - handy and professional Mac apps.">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://www.confluent.io/wp-content/uploads/ksql-query-1-768x244.png">
<meta property="og:updated_time" content="2017-08-29T07:17:17.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Open Source Streaming SQL for Apache Kafka - Gmagon Software - handy and professional Mac apps.">
<meta name="twitter:description" content="Open Source Streaming SQL for Apache Kafka - Gmagon Software - handy and professional Mac apps.">
<meta name="twitter:image" content="https://www.confluent.io/wp-content/uploads/ksql-query-1-768x244.png">
<meta name="twitter:site" content="gmagonshare">
<meta property="fb:admins" content="432634277117208">
<meat name="twitter:url" content="https://gmagon.com/blog/2017/08/29/sql-for-apache-kafka/index.html">



  <!-- algolia_config -->
  
  
  <!-- Canonical links -->
  <link rel="canonical" href="https://gmagon.com/blog/2017/08/29/sql-for-apache-kafka/index.html">

  <!-- Alternative links -->
  

  <!-- Icon -->
  <link rel="apple-touch-icon" sizes="57x57" href="/icon/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icon/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icon/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icon/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icon/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icon/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icon/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icon/apple-touch-icon-152x152.png">
  <link rel="icon" type="image/png" href="/icon/favicon-196x196.png" sizes="196x196">
  <link rel="icon" type="image/png" href="/icon/favicon-160x160.png" sizes="160x160">
  <link rel="icon" type="image/png" href="/icon/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/icon/favicon-16x16.png" sizes="16x16">
  <link rel="icon" type="image/png" href="/icon/favicon-32x32.png" sizes="32x32">
  <meta name="msapplication-TileColor" content="#2f83cd">
  <meta name="msapplication-TileImage" content="/icon/mstile-144x144.png">

  <!-- CSS -->
  <link rel="stylesheet" href="/build/css/navy-9c7f2a6219.css">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="/asset/styles/global.css">
  
  <!-- jQuery -->
  <script src="/js/jquery/jquery-3.2.1.min.js"></script>
<script src="/js/jquery/jquery-migrate-1.4.1.min.js"></script>



  <!-- ForPostLayout -->
  
    
    
  
  <!-- endForPostLayout -->

  <!-- RSS -->
  <link rel="alternate" href="/atom.xml" title="Gmagon Software - handy and professional Mac apps.">

  <!-- algolia_search -->
  <script src="/assets/algolia/algoliasearchLite.min.js" async></script>

  <!-- Utils -->
<script src="/js/utils.js"></script>
</head>

<body>
  <div id="container">
    <header id="header">
  <div class="wrapper">
    <div id="header-inner" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Gmagon Software - handy and professional Mac apps.</a>
        <span>gmagon </span>
      </h1>
      <nav id="main-nav">
        <a href="/" class="main-nav-link ">Home</a><a href="/products/" class="main-nav-link ">Products</a><a href="/guide/" class="main-nav-link ">Guide</a><a href="/support/" class="main-nav-link ">Support</a><a href="/blog/" class="main-nav-link ">Blog</a>
        <div id="search-input-wrap">
          <a href="/search/" class="text-decoration-none">
            <div id="search-input-icon">
              <i class="fa fa-search"></i>
            </div>
          </a>
        </div>
      </nav>
      <div id="lang-select-wrap">
        <label id="lang-select-label"><i class="fa fa-globe"></i><span>English</span></label>
        <select id="lang-select" data-canonical="">
          
            <option value="en" selected>English</option>
          
        </select>
      </div>
      <a id="mobile-nav-toggle">
        <span class="mobile-nav-toggle-bar"></span>
        <span class="mobile-nav-toggle-bar"></span>
        <span class="mobile-nav-toggle-bar"></span>
      </a>
    </div>
  </div>  
</header>
<div class="hide-wrap-head-top"></div>

    <div class="class-content-wrap">
  <div class="inner">
    <div class="inner-wrap fill-bunting font-e3">
      <h2 id="banner-title"> Open Source Streaming SQL for Apache Kafka </h2>
      <div id="banner-start">
        <a class="btn btn-static-secondary btn-shadow" href="https://gitter.im/Gmagon/support" ttarget="_blank" rel="nofollow me noopener noreferrer" >Need help?</a>
      </div>
    </div>
  </div>
</div>

<div class="class-content-wrap">
  <div class="wrapper">
    <div class="inner">
      <article class="article-container" itemscope itemtype="http://schema.org/Article">
        <div class="article-inner">
          <div class="article">
          <div class="hide-wrap-head-top"></div>
<article class="article post" itemscope itemtype="http://schema.org/Article">
  <header class="article-header">
    
      <h1 class="article-title" itemprop="name">Open Source Streaming SQL for Apache Kafka</h1>
    
    <a href="/blog/2017/08/29/sql-for-apache-kafka/" class="article-date"><time datetime="2017-08-29T00:00:00.000Z">2017-08-29</time></a>
  </header>
  <div class="article-content" itemprop="articleBody">
    <p>SQL, a streaming SQL engine for Apache KafkaTM. KSQL lowers the entry bar to the world of stream processing, providing a simple and completely interactive SQL interface for processing data in Kafka. You no longer need to write code in a programming language such as Java or Python! KSQL is open-source (Apache 2.0 licensed), distributed, scalable, reliable, and real-time. It supports a wide range of powerful stream processing operations including aggregations, joins, windowing, sessionization, and much more.</p>
<h3 id="A-Simple-Example"><a href="#A-Simple-Example" class="headerlink" title="A Simple Example"></a><strong>A Simple Example</strong></h3><p><img src="https://www.confluent.io/wp-content/uploads/ksql-query-1-768x244.png" alt=""></p>
<h3 id="What-does-it-even-mean-to-query-streaming-data-and-how-does-this-compare-to-a-SQL-database"><a href="#What-does-it-even-mean-to-query-streaming-data-and-how-does-this-compare-to-a-SQL-database" class="headerlink" title="What does it even mean to query streaming data, and how does this compare to a SQL database?"></a><strong>What does it even mean to query streaming data, and how does this compare to a SQL database?</strong></h3><p>Well, it’s actually quite different to a SQL database. Most databases are used for doing on-demand lookups and modifications to stored data. KSQL doesn’t do lookups (yet), what it does do is continuous transformations— that is, stream processing. For example, imagine that I have a stream of clicks from users and a table of account information about those users being continuously updated. KSQL allows me to model this stream of clicks, and table of users, and join the two together. Even though one of those two things is infinite.</p>
<p>So what KSQL runs arecontinuous queries— transformations that run continuously as new data passes through them — on streams of data in Kafka topics. In contrast, queries over a relational database areone-time queries —run once to completion over a data set—as in a SELECT statement on finite rows in a database.</p>
<h3 id="What-is-KSQL-Good-For"><a href="#What-is-KSQL-Good-For" class="headerlink" title="What is KSQL Good For?"></a><strong>What is KSQL Good For?</strong></h3><p>Great, so you can continuously query infinite streams of data. What is that good for?</p>
<p><strong>1. Real-time monitoring meets real-time analytics</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">CREATE TABLE error_counts AS</div><div class="line">SELECT error_code, count(*)FROM monitoring_stream</div><div class="line">WINDOW TUMBLING (SIZE 1 MINUTE)</div><div class="line">WHERE type = &apos;ERROR&apos;</div></pre></td></tr></table></figure>
<p>One use of this is defining custom business-level metrics that are computed in real-time and that you can monitor and alert off of, just like you do your CPU load. Another use is to define a notion of correctness for your application in KSQL and check that it is meeting this as it runs in production. Often when we think of monitoring we think about counters and gauges tracking low level performance statistics. These kinds of gauge often can tell you that your CPU load is high, but they can’t really tell you if your application is doing what it’s supposed to do. KSQL allows defining custom metrics off of streams of raw events that applications generate, whether they are logging events, database updates, or any other kind.</p>
<p>For example, a web app might need to check that every time a new customer signs up a welcome email is sent, a new user record is created, and their credit card is billed. These functions might be spread over different services or applications and you would want to monitor that each thing happened for each new customer within some SLA, like 30 secs.</p>
<p><strong>2. Security and anomaly detection</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">CREATE STREAM possible_fraud AS</div><div class="line">SELECT card_number, count(*)</div><div class="line">FROM authorization_attempts</div><div class="line">WINDOW TUMBLING (SIZE 5 SECONDS)</div><div class="line">GROUP BY card_number</div><div class="line">HAVING count(*) </div><div class="line">&gt;</div><div class="line"> 3;</div></pre></td></tr></table></figure>
<p>A simple version of this is what you saw in the demo above: KSQL queries that transform event streams into numerical time series aggregates that are pumped into Elastic using the Kafka-Elastic connector and visualized in a Grafana UI. Security use cases often look a lot like monitoring and analytics. Rather than monitoring application behavior or business behavior you’re looking for patterns of fraud, abuse, spam, intrusion, or other bad behavior. KSQL gives a simple, sophisticated, and real-time way of defining these patterns and querying real-time streams.</p>
<p><strong>3. Online data integration</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">CREATE STREAM vip_users AS</div><div class="line">SELECT userid, page, action </div><div class="line">FROM clickstream c </div><div class="line">LEFT JOIN users u ON c.userid = u.user_id</div><div class="line">WHERE u.level = &apos;Platinum&apos;;</div></pre></td></tr></table></figure>
<p>Much of the data processing done in companies falls in the domain of data enrichment: take data coming out of several databases, transform it, join it together, and store it into a key-value store, search index, cache, or other data serving system. For a long time, ETL — Extract, Transform, and Load — for data integration was performed as periodic batch jobs. For example, dump the raw data in real time, and then transform it every few hours to enable efficient queries. For many use cases, this delay is unacceptable. KSQL, when used with Kafka connectors, enables a move from batch data integration to online data integration. You can enrich streams of data with metadata stored in tables using stream-table joins, or do simple filtering of PII (personally identifiable information) data before loading the stream into another system.</p>
<p><strong>4. Application Development</strong></p>
<p>Many applications transform an input stream into an output stream. For example, a process responsible for reordering products that are running low in inventory for an online store might feed off a stream of sales and shipments to compute a stream of orders to place.</p>
<p>For more complex applications written in Java, Kafka’s native streams API may be just the thing. But for simple apps, or teams not interested in Java programming a simple SQL interface may be what they’re looking for.</p>
<h3 id="Core-Abstractions-in-KSQL"><a href="#Core-Abstractions-in-KSQL" class="headerlink" title="Core Abstractions in KSQL"></a><strong>Core Abstractions in KSQL</strong></h3><p>KSQL uses<a href="https://kafka.apache.org/documentation/streams/">Kafka’s Streams API</a>internally and they share the same core abstractions for stream processing on Kafka. There are two core abstractions in KSQL that map to the two core abstractions in Kafka Streams and allow you to manipulate Kafka topics:</p>
<p><strong>1. STREAM:</strong>A stream is an unbounded sequence of structured data (“facts”).  For example, we could have a stream of financial transactions such as “Alice sent $100 to Bob, then Charlie sent $50 to Bob”. Facts in a stream are immutable, which means new facts can be inserted to a stream, but existing facts can never be updated or deleted. Streams can be created from a Kafka topic or derived from existing streams and tables.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">CREATE STREAM pageviews (viewtime BIGINT, userid VARCHAR, pageid VARCHAR) </div><div class="line">WITH (kafka_topic=&apos;pageviews&apos;, value_format=’JSON’);</div></pre></td></tr></table></figure>
<p><strong>2. TABLE:</strong>A table is a view of a STREAM or another TABLE and represents a collection of evolving facts.  For example, we could have a table that contains the latest financial information such as “Bob’s current account balance is $150”.  It is the equivalent of a traditional database table but enriched by streaming semantics such as windowing.  Facts in a table are mutable, which means new facts can be inserted to the table, and existing facts can be updated or deleted.  Tables can be created from a Kafka topic or derived from existing streams and tables.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">CREATE TABLE users (registertime BIGINT, gender VARCHAR, regionid VARCHAR, userid  VARCHAR) </div><div class="line">WITH (kafka_topic=&apos;users&apos;, value_format=&apos;DELIMITED&apos;);</div></pre></td></tr></table></figure>
<p>KSQL simplifies streaming applications as it fully integrates the concepts oftablesandstreams,allowing joining tables that represent the current state of the world with streams that represent events that are happening right now. A topic in Apache Kafka can be represented as either a STREAM or a TABLE in KSQL, depending on the intended semantics of the processing on the topic. For instance, if you want to read the data in a topic as a series of independent values, you would use CREATE STREAM. An example of such a stream is a topic that captures page view events where each page view event is unrelated and independent of another. If, on the other hand, you want to read the data in a topic as an evolving collection of updatable values, you’d use CREATE TABLE. An example of a topic that should be read as a TABLE in KSQL is one that captures user metadata where each event represents latest metadata for a particular user id, be it user’s name, address or preferences.</p>
<h3 id="KSQL-in-Action-Real-time-clickstream-analytics-and-anomaly-detection"><a href="#KSQL-in-Action-Real-time-clickstream-analytics-and-anomaly-detection" class="headerlink" title="KSQL in Action: Real-time clickstream analytics and anomaly detection"></a><strong>KSQL in Action: Real-time clickstream analytics and anomaly detection</strong></h3><p>Let’s get down to a real demo.This demo shows how you can use KSQL for real-time monitoring, anomaly detection, and alerting. Real-time log analytics on clickstream data can take several forms. In this example, we flag malicious user sessions that are consuming too much bandwidth on our web servers. Monitoring malicious user sessions is one of many applications of sessionization. But broadly, sessions are the building blocks of user behavior analysis. Once you’ve associated users and events to a particular session identifier, you can build out many types of analyses, ranging from simple metrics, such as count of visits, to more complex metrics, such as customer conversion funnels and event flows. We end this demo by showing how you can visualize the output of KSQL queries continuously in real-time on a Grafana dashboard backed by Elastic.</p>
<p>Source: <a href="https://www.confluent.io/blog/ksql-open-source-streaming-sql-for-apache-kafka/">https://www.confluent.io/blog/ksql-open-source-streaming-sql-for-apache-kafka/</a></p>

  </div>
  

 <!-- jsSocials -->
<script src="/jssocials-1.4.0/jssocials.min.js"></script>
<link rel="stylesheet" href="/jssocials-1.4.0/jssocials.css">
<link rel="stylesheet" href="/jssocials-1.4.0/jssocials-theme-flat.css">

<div class="socials-share-btn"></div>
<script>
  if ($) {
    $(document).ready(function(){
      $(".socials-share-btn").jsSocials({
        shares: ["email", "twitter", "facebook", "googleplus", "linkedin", "pinterest", "stumbleupon", "whatsapp"]
      });
    })
  }
</script>


  
<section id="comments">
  <div id="disqus_thread"></div>
</section>
<script>
  var disqus_shortname = 'gmagon';
  var disqus_url = 'https://gmagon.com/blog/2017/08/29/sql-for-apache-kafka/index.html';
  var disqus_title = "Open Source Streaming SQL for Apache Kafka";
  var disqus_config = function(){
    this.language = 'en';
  };
  (function(){
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'https://go.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

  <script src="/js/audios.js"></script>
</article>

          </div>
      
          <aside id="article-toc" role="navigation">
                <div id="article-toc-inner">
                  <strong class="sidebar-title">Contents</strong>
                  <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#A-Simple-Example"><span class="toc-text">A Simple Example</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#What-does-it-even-mean-to-query-streaming-data-and-how-does-this-compare-to-a-SQL-database"><span class="toc-text">What does it even mean to query streaming data, and how does this compare to a SQL database?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#What-is-KSQL-Good-For"><span class="toc-text">What is KSQL Good For?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Core-Abstractions-in-KSQL"><span class="toc-text">Core Abstractions in KSQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#KSQL-in-Action-Real-time-clickstream-analytics-and-anomaly-detection"><span class="toc-text">KSQL in Action: Real-time clickstream analytics and anomaly detection</span></a></li></ol>
                  <a href="#" id="article-toc-top">Back to Top</a>
                </div>
          </aside>
        </div>
      </article>
    </div>
  </div>
</div>

<div class="class-content-wrap">
  <div class="inner">
    <div class="inner-wrap landing-bunting">
      <div class="intro-sub-content-wrap">
      </div>
    </div>
  </div>
</div>



    <footer id="footer" class="landing-bunting font-e3">
  <div class="inner">
    <div id="footer-some-docs">
        <a href="/terms_conditions.html" class="footer-doc-link" >Terms & Conditions</a>
        <a href="/privacy.html" class="footer-doc-link" >Privacy</a>
        <a href="/end-user-license-agreement.html" class="footer-doc-link" >License Agreement</a>
    </div>
    <div id="footer-copyright">
       <a href="" > Copyright &copy; 2017 Gmagon,Inc. All rights reserved. </a>
    </div>
  </div>

  <div class="inner">
    <div id="footer-links">
        
        <a href="https://twitter.com/gmagonshare" class="footer-link" target="_blank" rel="nofollow me noopener noreferrer" ><i class="fa fa-twitter"></i></a>
        
        <a href="https://www.facebook.com/gmagonshare" class="footer-link" target="_blank" rel="nofollow me noopener noreferrer" ><i class="fa fa-facebook"></i></a>
        <a href="https://www.youtube.com/gmagonshare" class="footer-link" target="_blank" rel="nofollow me noopener noreferrer" ><i class="fa fa-youtube"></i></a>
        <a href="https://www.instagram.com/gmagonshare" class="footer-link" target="_blank" rel="nofollow me noopener noreferrer" ><i class="fa fa-instagram"></i></a>
    </div>
  </div>


  <div class="inner">
    <div id="footer-security">
       <p>
          <img src="/asset/images/security/klogo.png">
          <img src="/asset/images/security/mcafee.png">
          <img src="/asset/images/security/cmmodo_scanned.png">
          <img src="/asset/images/security/softonic_tested.png">
          <img src="/asset/images/security/tested_by_sucuri.png">
          <img src="/asset/images/security/norton.png">
          <img src="/asset/images/security/eset_logo.png">
       </p>
    </div>
  </div>




</footer>

  </div>
  <div id="mobile-nav-dimmer"></div>
  <nav id="mobile-nav">
  <div id="mobile-nav-inner">
    <ul id="mobile-nav-list">
      <a href="/" class="mobile-nav-link ">Home</a><a href="/products/" class="mobile-nav-link ">Products</a><a href="/guide/" class="mobile-nav-link ">Guide</a><a href="/support/" class="mobile-nav-link ">Support</a><a href="/blog/" class="mobile-nav-link ">Blog</a>
      
    </ul>
    
  </div>
  <div id="mobile-lang-select-wrap">
    <span id="mobile-lang-select-label"><i class="fa fa-globe"></i><span>English</span></span>
    <select id="mobile-lang-select" data-canonical="">
      
        <option value="en" selected>English</option>
      
    </select>
  </div>
</nav>

  <!-- Scripts -->
<script src="/build/js/main-8277743eaa.js"></script>
<!-- <script src="https://cdn.jsdelivr.net/retinajs/1.3.0/retina.min.js" async></script> -->

<!-- totop -->
<div id="gmagon_totop" style="position:fixed;bottom:150px;right:30px;cursor: pointer;">
  <a title="Back to top"><img src="/asset/images/scroll-up.png"/></a>
</div>
<script src="/js/totop.js"></script>





<!-- Google Analytics -->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-99314951-1', 'auto');
  ga('send', 'pageview');
</script>


</body>
</html>