<!DOCTYPE html>
<html lang="en">
<head prefix="og: http://ogp.me/ns#">
  <meta charset="utf-8">

  <title>Creating a Simple Game With Core ML in Swift 4 - Gmagon Software - handy and professional Mac apps.</title>

  <meta http-equiv="X-UA-Compatible" content="IE=8; IE=9; IE=Edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta name="robots" content="noodp" />
  <meta name="keywords" content="Creating a Simple Game With Core ML in Swift 4" />
  <meta name="description" content="Creating a Simple Game With Core ML in Swift 4" />

  <!-- Custom config og:image -->


  <!-- Open Graph -->
<meta name="description" content="Creating a Simple Game With Core ML in Swift 4 - Gmagon Software - handy and professional Mac apps.">
<meta property="og:type" content="apps">
<meta property="og:title" content="Creating a Simple Game With Core ML in Swift 4 - Gmagon Software - handy and professional Mac apps.">
<meta property="og:url" content="https://gmagon.com/blog/2017/07/06/creating-a-simple-game-with-core-ml-in-swift-4/index.html">
<meta property="og:site_name" content="Creating a Simple Game With Core ML in Swift 4 - Gmagon Software - handy and professional Mac apps.">
<meta property="og:description" content="Creating a Simple Game With Core ML in Swift 4 - Gmagon Software - handy and professional Mac apps.">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://img0.tuicool.com/NJnu2mQ.png!web">
<meta property="og:image" content="http://img1.tuicool.com/fyyeieJ.png!web">
<meta property="og:image" content="http://img0.tuicool.com/AvQbmuF.png!web">
<meta property="og:image" content="http://img1.tuicool.com/Yvi2EzV.png!web">
<meta property="og:image" content="http://img1.tuicool.com/eE32MjY.png!web">
<meta property="og:image" content="http://img1.tuicool.com/uaqQnmN.png!web">
<meta property="og:image" content="http://img2.tuicool.com/uMv63uz.png!web">
<meta property="og:image" content="http://img0.tuicool.com/zI7bAvr.png!web">
<meta property="og:image" content="http://img0.tuicool.com/URbymuU.png!web">
<meta property="og:image" content="http://img2.tuicool.com/6NnMr2V.png!web">
<meta property="og:updated_time" content="2017-07-11T09:37:19.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Creating a Simple Game With Core ML in Swift 4 - Gmagon Software - handy and professional Mac apps.">
<meta name="twitter:description" content="Creating a Simple Game With Core ML in Swift 4 - Gmagon Software - handy and professional Mac apps.">
<meta name="twitter:image" content="http://img0.tuicool.com/NJnu2mQ.png!web">
<meta name="twitter:site" content="gmagonshare">
<meta property="fb:admins" content="432634277117208">
<meat name="twitter:url" content="https://gmagon.com/blog/2017/07/06/creating-a-simple-game-with-core-ml-in-swift-4/index.html">



  <!-- algolia_config -->
  
  
  <!-- Canonical links -->
  <link rel="canonical" href="https://gmagon.com/blog/2017/07/06/creating-a-simple-game-with-core-ml-in-swift-4/index.html">

  <!-- Alternative links -->
  

  <!-- Icon -->
  <link rel="apple-touch-icon" sizes="57x57" href="/icon/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icon/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icon/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icon/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icon/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icon/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icon/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icon/apple-touch-icon-152x152.png">
  <link rel="icon" type="image/png" href="/icon/favicon-196x196.png" sizes="196x196">
  <link rel="icon" type="image/png" href="/icon/favicon-160x160.png" sizes="160x160">
  <link rel="icon" type="image/png" href="/icon/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/icon/favicon-16x16.png" sizes="16x16">
  <link rel="icon" type="image/png" href="/icon/favicon-32x32.png" sizes="32x32">
  <meta name="msapplication-TileColor" content="#2f83cd">
  <meta name="msapplication-TileImage" content="/icon/mstile-144x144.png">

  <!-- CSS -->
  <link rel="stylesheet" href="/build/css/navy-9c7f2a6219.css">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="/asset/styles/global.css">
  
  <!-- jQuery -->
  <script src="/js/jquery/jquery-3.2.1.min.js"></script>
<script src="/js/jquery/jquery-migrate-1.4.1.min.js"></script>



  <!-- ForPostLayout -->
  
    
    
  
  <!-- endForPostLayout -->

  <!-- RSS -->
  <link rel="alternate" href="/atom.xml" title="Gmagon Software - handy and professional Mac apps.">

  <!-- algolia_search -->
  <script src="/assets/algolia/algoliasearchLite.min.js" async></script>

  <!-- Utils -->
<script src="/js/utils.js"></script>
</head>

<body>
  <div id="container">
    <header id="header">
  <div class="wrapper">
    <div id="header-inner" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Gmagon Software - handy and professional Mac apps.</a>
        <span>gmagon </span>
      </h1>
      <nav id="main-nav">
        <a href="/" class="main-nav-link ">Home</a><a href="/products/" class="main-nav-link ">Products</a><a href="/guide/" class="main-nav-link ">Guide</a><a href="/support/" class="main-nav-link ">Support</a><a href="/blog/" class="main-nav-link ">Blog</a>
        <div id="search-input-wrap">
          <a href="/search/" class="text-decoration-none">
            <div id="search-input-icon">
              <i class="fa fa-search"></i>
            </div>
          </a>
        </div>
      </nav>
      <div id="lang-select-wrap">
        <label id="lang-select-label"><i class="fa fa-globe"></i><span>English</span></label>
        <select id="lang-select" data-canonical="">
          
            <option value="en" selected>English</option>
          
        </select>
      </div>
      <a id="mobile-nav-toggle">
        <span class="mobile-nav-toggle-bar"></span>
        <span class="mobile-nav-toggle-bar"></span>
        <span class="mobile-nav-toggle-bar"></span>
      </a>
    </div>
  </div>  
</header>
<div class="hide-wrap-head-top"></div>

    <div class="class-content-wrap">
  <div class="inner">
    <div class="inner-wrap fill-bunting font-e3">
      <h2 id="banner-title"> Creating a Simple Game With Core ML in Swift 4 </h2>
      <div id="banner-start">
        <a class="btn btn-static-secondary btn-shadow" href="https://gitter.im/Gmagon/support" ttarget="_blank" rel="nofollow me noopener noreferrer" >Need help?</a>
      </div>
    </div>
  </div>
</div>

<div class="class-content-wrap">
  <div class="wrapper">
    <div class="inner">
      <article class="article-container" itemscope itemtype="http://schema.org/Article">
        <div class="article-inner">
          <div class="article">
          <div class="hide-wrap-head-top"></div>
<article class="article post" itemscope itemtype="http://schema.org/Article">
  <header class="article-header">
    
      <h1 class="article-title" itemprop="name">Creating a Simple Game With Core ML in Swift 4</h1>
    
    <a href="/blog/2017/07/06/creating-a-simple-game-with-core-ml-in-swift-4/" class="article-date"><time datetime="2017-07-06T00:00:00.000Z">2017-07-06</time></a>
  </header>
  <div class="article-content" itemprop="articleBody">
    <p>WWDC 2017 brought many amazing and powerful APIs to iOS. Among the most popular is<a href="https://developer.apple.com/documentation/coreml">Core ML</a>(of course, ARKit is hot too!). Core ML allows developers to use machine learning models in their apps without the knowledge of neural networks or machine learning algorithms. Today, I will show you how simple it is to create a game using Core ML. We will be creating a simple scavenger hunt game which will have the player running around the room looking for objects. We have already covered<a href="http://www.appcoda.com/coreml-introduction">the basics of Core ML in our tutorial</a>which I suggest you read over before continuing.</p>
<p>Note:You will need Xcode 9 beta to for this tutorial. You will also need a device that is running iOS 11 beta in order to test out the app. This app will NOT run in the simulator. The also might run slow on older devices such as the iPhone 5s. While Xcode 9 beta supports both Swift 3.2 and 4.0, all the code in this tutorial is written in Swift 4.</p>
<h2 id="App-Overview"><a href="#App-Overview" class="headerlink" title="App Overview"></a>App Overview</h2><p>The game that we are making today is simple to create and play. After the user taps the Start button, the name of a random object will appear at the top of the screen. It is the player’s job to find that object. Once the player does, they will point the phone at it. Using the machine learning algorithm, the iPhone will recognize the object and then ask for another one. Every object found adds a point to the score. The player also has the option to skip an object if they cannot find it.</p>
<p>This app recognizes objects slightly differently than the one demonstrated in the Introduction to Core ML tutorial. This is mainly because we will have a live camera view and predicting objects in real time rather than choosing a single photo.</p>
<p><img src="http://img0.tuicool.com/NJnu2mQ.png!web" alt=""></p>
<h2 id="Creating-the-Project"><a href="#Creating-the-Project" class="headerlink" title="Creating the Project"></a>Creating the Project</h2><p>First things first! Let’s open Xcode 9 beta and create a new project. Choose the_Single View App_template for this app. Though we are building a game, the Single View Application template is good enough. I will be naming the project_CoreMLScavenge_but you can name it whatever you wish. Make sure to set the language to<em>Swift</em>.</p>
<p><img src="http://img1.tuicool.com/fyyeieJ.png!web" alt=""></p>
<p>Once the project is created, uncheck the boxes next to<code>Landscape Left</code>and<code>Landscape Right</code>. We will stick to portrait mode for this game.</p>
<p><img src="http://img0.tuicool.com/AvQbmuF.png!web" alt=""></p>
<h2 id="Creating-the-User-Interface"><a href="#Creating-the-User-Interface" class="headerlink" title="Creating the User Interface"></a>Creating the User Interface</h2><p>Now it’s time to have fun! Go to the<code>Main.storyboard</code>file in the project navigator. Start by adding a<code>View</code>to the top and bottom of the View Controller. Stretch the widths to the size of the View Controller and make the height around 85 pixels for each. The entire background is going to be the live camera feed, so we are adding these views so we can see the labels and buttons on top of it. Make the background of the view a light-gray color. This way we know not to accidentally put any elements on top of it.</p>
<p><img src="http://img1.tuicool.com/Yvi2EzV.png!web" alt=""></p>
<p>In the top view, add a<code>UILabel</code>to the center and another one to the left. The center label will show the object for the player to find, so stretch it out a bit so it can fit longer words. The label on the left will show the score. You can condense it a bit since it will only need to show two digits.</p>
<p><img src="http://img1.tuicool.com/eE32MjY.png!web" alt=""></p>
<p>In the bottom view, add two<code>UILabel</code>s and two<code>UIButtons</code>. One label will show the score, and the other will show the player’s highest score. Make one of the buttons say “start”, which will of course start the game. Make the other button say “skip”. The players can tap this if they cannot find the object and want another one.</p>
<p><img src="http://img1.tuicool.com/uaqQnmN.png!web" alt=""></p>
<p>I will not cover how to add layout constraints to these elements in this tutorial. However, I highly suggest that you do. Check out ourAuto Layout Tutorial if you would like to learn how to use it. If you are not going to use Auto Layout, be sure to make your view controller’s size to the type of the device you are going to run the app on.</p>
<h2 id="Setting-Up-the-View"><a href="#Setting-Up-the-View" class="headerlink" title="Setting Up the View"></a>Setting Up the View</h2><p>Now that the UI is done, we can start coding. Select the<code>ViewController.swift</code>file in the project navigator. Let’s start by importing the necessary frameworks above the class.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">import</div><div class="line"> MobileCoreServices</div><div class="line"></div><div class="line">import</div><div class="line"> Vision</div><div class="line"></div><div class="line">import</div><div class="line"> CoreML</div><div class="line"></div><div class="line">import</div><div class="line"> AVKit</div></pre></td></tr></table></figure>
<p>Next add the outlets so we can connect our code to the UI. We need to add 8 outlets in total.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">@IBOutlet</div><div class="line"> var </div><div class="line">scoreLabel</div><div class="line">: UILabel!</div><div class="line">    </div><div class="line">@IBOutlet</div><div class="line"> var </div><div class="line">highscoreLabel</div><div class="line">: UILabel!</div><div class="line">    </div><div class="line">@IBOutlet</div><div class="line"> var </div><div class="line">timeLabel</div><div class="line">: UILabel!</div><div class="line">    </div><div class="line">@IBOutlet</div><div class="line"> var </div><div class="line">objectLabel</div><div class="line">: UILabel!</div><div class="line">    </div><div class="line">@IBOutlet</div><div class="line"> var </div><div class="line">startButton</div><div class="line">: UIButton!</div><div class="line">    </div><div class="line">@IBOutlet</div><div class="line"> var </div><div class="line">skipButton</div><div class="line">: UIButton!</div><div class="line">    </div><div class="line">@IBOutlet</div><div class="line"> var </div><div class="line">topView</div><div class="line">: UIView!</div><div class="line">    </div><div class="line">@IBOutlet</div><div class="line"> var </div><div class="line">bottomView</div><div class="line">: UIView!</div></pre></td></tr></table></figure>
<p>Your code should now look like this:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">import</div><div class="line">UIKit</div><div class="line">import</div><div class="line">MobileCoreServices</div><div class="line">import</div><div class="line">Vision</div><div class="line">import</div><div class="line">CoreML</div><div class="line">import</div><div class="line">AVKit</div><div class="line">class</div><div class="line">ViewController</div><div class="line">: </div><div class="line">UIViewController</div><div class="line"> &#123;</div><div class="line">    </div><div class="line">@IBOutlet</div><div class="line"> var </div><div class="line">scoreLabel</div><div class="line">: UILabel!</div><div class="line">    </div><div class="line">@IBOutlet</div><div class="line"> var </div><div class="line">highscoreLabel</div><div class="line">: UILabel!</div><div class="line">    </div><div class="line">@IBOutlet</div><div class="line"> var </div><div class="line">timeLabel</div><div class="line">: UILabel!</div><div class="line">    </div><div class="line">@IBOutlet</div><div class="line"> var </div><div class="line">objectLabel</div><div class="line">: UILabel!</div><div class="line">    </div><div class="line">@IBOutlet</div><div class="line"> var </div><div class="line">startButton</div><div class="line">: UIButton!</div><div class="line">    </div><div class="line">@IBOutlet</div><div class="line"> var </div><div class="line">skipButton</div><div class="line">: UIButton!</div><div class="line">    </div><div class="line">@IBOutlet</div><div class="line"> var </div><div class="line">topView</div><div class="line">: UIView!</div><div class="line">    </div><div class="line">@IBOutlet</div><div class="line"> var </div><div class="line">bottomView</div><div class="line">: UIView!</div><div class="line"> </div><div class="line">    override func viewDidLoad() &#123;</div><div class="line">        </div><div class="line">super</div><div class="line">.viewDidLoad</div><div class="line">()</div><div class="line">        </div><div class="line">// Do any additional setup after loading the view, typically from a nib.</div><div class="line"></div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    </div><div class="line">override</div><div class="line">func</div><div class="line">didReceiveMemoryWarning</div><div class="line">() &#123;</div><div class="line">        </div><div class="line">super</div><div class="line">.didReceiveMemoryWarning</div><div class="line">()</div><div class="line">        </div><div class="line">// Dispose of any resources that can be recreated.</div><div class="line"></div><div class="line">    &#125;</div><div class="line"> </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Now we need to create some global variables. Let’s add the following variables right under where we added the outlets.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">var</div><div class="line"> cameraLayer: CALayer!</div><div class="line">    </div><div class="line">var</div><div class="line"> gameTimer: Timer!</div><div class="line">    </div><div class="line">var</div><div class="line"> timeRemaining = </div><div class="line">60</div><div class="line">var</div><div class="line"> currentScore = </div><div class="line">0</div><div class="line">var</div><div class="line"> highScore = </div><div class="line">0</div></pre></td></tr></table></figure>
<p>Let me explain each variable one by one:</p>
<p>Line #1:This is the camera layer which we will add to the view later on. It will take up the entire background of the screen.</p>
<p>Line #2:We will initialize the game timer later. We are making it global so we can invalidate it (stop it) from any function.</p>
<p>Line #3:This variable will hold the time remaining in the game and it is initialized to 60 so the game lasts one minute. Feel free to change it to another number if you want the game to be shorter or longer.</p>
<p>Line #4:This will hold the player’s score and increase by one each time they find an object.</p>
<p>Line #5:This will hold the player’s high score. It will be set from UserDefaults each time the app loads.</p>
<p>Putting a lot of code in the<code>viewDidLoad</code>can make our code look messy and unorganized. To fix this, we’re going to add a<code>viewSetup</code>function right after the<code>viewDidLoad</code>to take care of some of the basic UI settings that need to be done at runtime.</p>
<p>Add this into the<code>viewDidLoad</code>:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">viewSetup</div><div class="line">()</div></pre></td></tr></table></figure>
<p>Then add this right after the<code>viewDidLoad</code>:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">func</div><div class="line">viewSetup</div><div class="line">()</div><div class="line"> &#123;</div><div class="line">        </div><div class="line">    </div><div class="line">let</div><div class="line"> backgroundColor = </div><div class="line">UIColor</div><div class="line">.</div><div class="line">init</div><div class="line">(red: </div><div class="line">255</div><div class="line">/</div><div class="line">255</div><div class="line">, green: </div><div class="line">255</div><div class="line">/</div><div class="line">255</div><div class="line">, blue: </div><div class="line">255</div><div class="line">/</div><div class="line">255</div><div class="line">, alpha: </div><div class="line">0.8</div><div class="line">)</div><div class="line">    topView.backgroundColor = backgroundColor</div><div class="line">    bottomView.backgroundColor = backgroundColor</div><div class="line">    scoreLabel.text = </div><div class="line">&quot;0&quot;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>What this is doing is adding some transparency to the top and bottom views so we can see the live camera feed behind them. We are also setting the score label text to 0.</p>
<p>Your code should now look like this:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">import</div><div class="line"> UIKit</div><div class="line"></div><div class="line">import</div><div class="line"> MobileCoreServices</div><div class="line"></div><div class="line">import</div><div class="line"> Vision</div><div class="line"></div><div class="line">import</div><div class="line"> CoreML</div><div class="line"></div><div class="line">import</div><div class="line"> AVKit</div><div class="line"> </div><div class="line"></div><div class="line">class</div><div class="line">ViewController</div><div class="line">: </div><div class="line">UIViewController</div><div class="line">&#123;</div><div class="line">    </div><div class="line">@IBOutlet</div><div class="line">var</div><div class="line"> scoreLabel: </div><div class="line">UILabel</div><div class="line">!</div><div class="line">    </div><div class="line">@IBOutlet</div><div class="line">var</div><div class="line"> highscoreLabel: </div><div class="line">UILabel</div><div class="line">!</div><div class="line">    </div><div class="line">@IBOutlet</div><div class="line">var</div><div class="line"> timeLabel: </div><div class="line">UILabel</div><div class="line">!</div><div class="line">    </div><div class="line">@IBOutlet</div><div class="line">var</div><div class="line"> objectLabel: </div><div class="line">UILabel</div><div class="line">!</div><div class="line">    </div><div class="line">@IBOutlet</div><div class="line">var</div><div class="line"> startButton: </div><div class="line">UIButton</div><div class="line">!</div><div class="line">    </div><div class="line">@IBOutlet</div><div class="line">var</div><div class="line"> skipButton: </div><div class="line">UIButton</div><div class="line">!</div><div class="line">    </div><div class="line">@IBOutlet</div><div class="line">var</div><div class="line"> topView: </div><div class="line">UIView</div><div class="line">!</div><div class="line">    </div><div class="line">@IBOutlet</div><div class="line">var</div><div class="line"> bottomView: </div><div class="line">UIView</div><div class="line">!</div><div class="line">    </div><div class="line">    </div><div class="line">var</div><div class="line"> cameraLayer: </div><div class="line">CALayer</div><div class="line">!</div><div class="line">    </div><div class="line">var</div><div class="line"> gameTimer: </div><div class="line">Timer</div><div class="line">!</div><div class="line">    </div><div class="line">var</div><div class="line"> timeRemaining = </div><div class="line">60</div><div class="line">var</div><div class="line"> currentScore = </div><div class="line">0</div><div class="line">var</div><div class="line"> highScore = </div><div class="line">0</div><div class="line">override</div><div class="line">func</div><div class="line">viewDidLoad</div><div class="line">()</div><div class="line"> &#123;</div><div class="line">        </div><div class="line">super</div><div class="line">.viewDidLoad()</div><div class="line">        </div><div class="line">        viewSetup()</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    </div><div class="line">func</div><div class="line">viewSetup</div><div class="line">()</div><div class="line"> &#123;</div><div class="line">        </div><div class="line">        </div><div class="line">let</div><div class="line"> backgroundColor = </div><div class="line">UIColor</div><div class="line">.</div><div class="line">init</div><div class="line">(red: </div><div class="line">255</div><div class="line">/</div><div class="line">255</div><div class="line">, green: </div><div class="line">255</div><div class="line">/</div><div class="line">255</div><div class="line">, blue: </div><div class="line">255</div><div class="line">/</div><div class="line">255</div><div class="line">, alpha: </div><div class="line">0.8</div><div class="line">)</div><div class="line">        topView.backgroundColor = backgroundColor</div><div class="line">        bottomView.backgroundColor = backgroundColor</div><div class="line">        scoreLabel.text = </div><div class="line">&quot;0&quot;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    </div><div class="line">override</div><div class="line">func</div><div class="line">didReceiveMemoryWarning</div><div class="line">()</div><div class="line"> &#123;</div><div class="line">        </div><div class="line">super</div><div class="line">.didReceiveMemoryWarning()</div><div class="line">        </div><div class="line">// Dispose of any resources that can be recreated.</div><div class="line"></div><div class="line">    &#125;</div><div class="line"> </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Setting-Up-the-Camera"><a href="#Setting-Up-the-Camera" class="headerlink" title="Setting Up the Camera"></a>Setting Up the Camera</h2><p>Now it’s time to setup the live camera feed which will the entire background of the view. Before we start adding code, we need to ask the user’s permission to use the camera. iOS will take care of most of the work related to this. However, we need to provide a description of why we need the camera.</p>
<p>Head over to the<code>info.plist</code>file in the project navigator. Add a row with the key_Privacy – Camera Usage Description_and type a description in the value.</p>
<p><img src="http://img2.tuicool.com/uMv63uz.png!web" alt=""></p>
<p>Now it’s time to add code. To keep things organized, we will add the code to prepare the camera in a function called<code>cameraSetup</code>.</p>
<p>Add the following to the<code>viewDidLoad</code>under<code>viewSetup</code>method call:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">cameraSetup</div><div class="line">()</div></pre></td></tr></table></figure>
<p>Next, add the following function after the<code>viewSetup()</code>function:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">func</div><div class="line">cameraSetup</div><div class="line">()</div><div class="line"> &#123;</div><div class="line">        </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Now we are going to create something called<code>AVCaptureSession</code>which will make it possible to have a real time capture. Add the following to the<code>cameraSetup</code>function:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">let</div><div class="line"> captureSession = AVCaptureSession()</div><div class="line">captureSession.sessionPreset = AVCaptureSession.Preset.photo</div><div class="line"></div><div class="line">let</div><div class="line"> backCamera = AVCaptureDevice.</div><div class="line">default</div><div class="line">(.builtInWideAngleCamera, </div><div class="line">for</div><div class="line">: .video, position: .back)!</div><div class="line"></div><div class="line">let</div><div class="line"> input = </div><div class="line">try</div><div class="line">! AVCaptureDeviceInput(device: backCamera)</div><div class="line">captureSession.addInput(input)</div></pre></td></tr></table></figure>
<p>So what is going on here?</p>
<p>Line #1:We create the<code>AVCaptureSession</code>constant.</p>
<p>Line #2:We set the preset for the caption which pretty much sets the quality for the output. We are setting it to photo for it to be high resolution.</p>
<p>Line #3:We create an AVCaptureDevice which is the back camera. There is no reason to use the front camera for this game.</p>
<p>Line #4:We specify that we are using the back camera by referencing the backCamera AVCaptureDevice.</p>
<p>Line #5:We are adding the backCamera device as the input for the captureSession.</p>
<p>Remember the variable we made earlier called<code>cameraLayer</code>? Now it’s time to use it. We’re going to be adding the camera layer as a sublayer and setting it to the view controller’s size.</p>
<p>Add the following after the code we just added for the capture session:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">cameraLayer = AVCaptureVideoPreviewLayer(session: captureSession)</div><div class="line"></div><div class="line">view</div><div class="line">.layer.addSublayer(cameraLayer)</div><div class="line">cameraLayer.frame = </div><div class="line">view</div><div class="line">.bounds</div><div class="line"> </div><div class="line"></div><div class="line">view</div><div class="line">.bringSubview(toFron</div><div class="line">t:</div><div class="line"> topView)</div><div class="line"></div><div class="line">view</div><div class="line">.bringSubview(toFron</div><div class="line">t:</div><div class="line"> bottomView)</div></pre></td></tr></table></figure>
<p>Line #1-3:Here we are initializing the<code>cameraLayer</code>as an<code>AVCaptureVideoPreviewLayer</code>and setting the setting parameter to<code>captureSession</code>. After that, we add it to the view as a sublayer and set the size to the size of the entire view controller.</p>
<p>Line #5-6:Here we are bringing the top and bottom views to the front. This way, the camera layer doesn’t cover them.</p>
<p>To finish off this function, add the following code under what we just added:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">let videoOutput = AVCaptureVideoDataOutput()</div><div class="line">videoOutput.setSampleBufferDelegate(self, </div><div class="line">queue:</div><div class="line"> DispatchQueue(</div><div class="line">label:</div><div class="line">&quot;buffer delegate&quot;</div><div class="line">))</div><div class="line">videoOutput.recommendedVideoSettings(</div><div class="line">forVideoCodecType:</div><div class="line"> .jpeg, </div><div class="line">assetWriterOutputFileType:</div><div class="line"> .mp4)</div><div class="line"> </div><div class="line">captureSession.addOutput(videoOutput)</div><div class="line">captureSession.sessionPreset = .high</div><div class="line">captureSession.startRunning()</div></pre></td></tr></table></figure>
<p>Line #1-3:Here we are creating the data output and specifying the output settings. You will see an error here but don’t worry about it. We will take care of that soon.</p>
<p>Line #5-7:Finally, we add the video output to the capture session and start running it.</p>
<p>The<code>cameraSetup</code>function should now look like this:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">func cameraSetup() &#123;</div><div class="line">    </div><div class="line">let</div><div class="line"> captureSession = AVCaptureSession()</div><div class="line">    captureSession.sessionPreset = AVCaptureSession.Preset.photo</div><div class="line">        </div><div class="line">    </div><div class="line">let</div><div class="line"> backCamera = AVCaptureDevice.default(.builtInWideAngleCamera, </div><div class="line">for</div><div class="line">: .video, position: .back)!</div><div class="line">    </div><div class="line">let</div><div class="line">input</div><div class="line"> = try! AVCaptureDeviceInput(device: backCamera)</div><div class="line">        </div><div class="line">    captureSession.addInput(</div><div class="line">input</div><div class="line">)</div><div class="line">        </div><div class="line">    cameraLayer = AVCaptureVideoPreviewLayer(session: captureSession)</div><div class="line">    </div><div class="line">view</div><div class="line">.layer.addSublayer(cameraLayer)</div><div class="line">    cameraLayer.frame = </div><div class="line">view</div><div class="line">.bounds</div><div class="line">    </div><div class="line">view</div><div class="line">.bringSubview(toFron</div><div class="line">t:</div><div class="line"> topView)</div><div class="line">    </div><div class="line">view</div><div class="line">.bringSubview(toFron</div><div class="line">t:</div><div class="line"> bottomView)</div><div class="line">        </div><div class="line">    </div><div class="line">let</div><div class="line"> videoOutput = AVCaptureVideoDataOutput()</div><div class="line">    videoOutput.setSampleBufferDelegate(self, queue: DispatchQueue(labe</div><div class="line">l:</div><div class="line">&quot;buffer delegate&quot;</div><div class="line">))</div><div class="line">    videoOutput.recommendedVideoSettings(forVideoCodecType: .jpeg, assetWriterOutputFileType: .mp4)</div><div class="line">        </div><div class="line">    captureSession.addOutput(videoOutput)</div><div class="line">    captureSession.sessionPreset = .high</div><div class="line">    captureSession.startRunning()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Adding-the-Core-ML-Data-Model"><a href="#Adding-the-Core-ML-Data-Model" class="headerlink" title="Adding the Core ML Data Model"></a>Adding the Core ML Data Model</h2><p>After setting up the UI and camera, it is time to work with Core ML for object recognition.</p>
<p>Before we continue coding, we need to add the Core ML data model into the project. In order to use Core ML, you need to have a pre-trained model. While it is possible to build your own model for this game, we will use a model available on Apple’s developer website.</p>
<p>Go to<a href="https://developer.apple.com/machine-learning/">“Apple’s machine learning website”</a>and scroll to the bottom. Here you will find four different pre-trained Core ML models available for download.</p>
<p><img src="http://img0.tuicool.com/zI7bAvr.png!web" alt=""></p>
<p>For this game, we will be using the_Inception V3_model. Once you have the model downloaded, drag it into the Xcode project’s project navigator. Click on it and observe what is displayed.</p>
<p><img src="http://img0.tuicool.com/URbymuU.png!web" alt=""></p>
<p>Note:Please make sure that Target Membership of the project is selected, otherwise, your app will not be able to access the file.</p>
<p>As you can see, this model has a type of a<em>Neural Network Classifier</em>. It takes in an image size 299×299 and outputs two things. A dictionary which is the probability or confidence level for the calculations of the model, and a string with the actual name of the object in the picture.</p>
<h2 id="Predicting-the-Object"><a href="#Predicting-the-Object" class="headerlink" title="Predicting the Object"></a>Predicting the Object</h2><p>Now our little field trip is over and it’s time go to back to the<code>View Controller</code>and add two awesome functions that make the magic happen.</p>
<p>First we’re going to add the<code>predict</code>function. Add the following code after the<code>cameraSetup</code>function:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">func</div><div class="line">predict</div><div class="line">(image: CGImage)</div><div class="line"> &#123;</div><div class="line">    </div><div class="line">let</div><div class="line"> model = </div><div class="line">try</div><div class="line">! </div><div class="line">VNCoreMLModel</div><div class="line">(</div><div class="line">for</div><div class="line">: </div><div class="line">Inceptionv3</div><div class="line">().model)</div><div class="line">    </div><div class="line">let</div><div class="line"> request = </div><div class="line">VNCoreMLRequest</div><div class="line">(model: model, completionHandler: results)</div><div class="line">    </div><div class="line">let</div><div class="line"> handler = </div><div class="line">VNSequenceRequestHandler</div><div class="line">()</div><div class="line">    </div><div class="line">try</div><div class="line">! handler.perform([request], on: image)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Don’t let its size fool you, this is a powerful function. Here is what the code does:</p>
<p>Line #2:We create a model constant for the Inception V3 model.</p>
<p>Line #3:We create a<code>VNCoreMLRequest</code>which will call the results function (we are writing that next, so don’t worry about the error.)</p>
<p>Line #4-5:We create a constant for a<code>VNSequenceRequestHandler</code>object and then perform it with the image passed into the predict function via its parameter.</p>
<p>Next, it’s time to add the<code>results</code>function which will handle the results of the<code>predict</code>method and keep the game moving forward.</p>
<p>Add the following code after the<code>predict</code>function:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">func</div><div class="line">results</div><div class="line">(request: VNRequest, error: Error?)</div><div class="line"> &#123;</div><div class="line">    </div><div class="line">guard</div><div class="line">let</div><div class="line"> results = request.results </div><div class="line">as</div><div class="line">? [</div><div class="line">VNClassificationObservation</div><div class="line">] </div><div class="line">else</div><div class="line"> &#123;</div><div class="line">        </div><div class="line">print</div><div class="line">(</div><div class="line">&quot;No result found&quot;</div><div class="line">)</div><div class="line">        </div><div class="line">return</div><div class="line"></div><div class="line">    &#125;</div><div class="line">        </div><div class="line">    </div><div class="line">guard</div><div class="line"> results.</div><div class="line">count</div><div class="line"> != </div><div class="line">0</div><div class="line">else</div><div class="line"> &#123;</div><div class="line">        </div><div class="line">print</div><div class="line">(</div><div class="line">&quot;No result found&quot;</div><div class="line">)</div><div class="line">        </div><div class="line">return</div><div class="line"></div><div class="line">    &#125;</div><div class="line">        </div><div class="line">    </div><div class="line">let</div><div class="line"> highestConfidenceResult = results.first!</div><div class="line">    </div><div class="line">let</div><div class="line"> identifier = highestConfidenceResult.identifier.</div><div class="line">contains</div><div class="line">(</div><div class="line">&quot;, &quot;</div><div class="line">) ? </div><div class="line">String</div><div class="line">(describing: highestConfidenceResult.identifier.</div><div class="line">split</div><div class="line">(separator: </div><div class="line">&quot;,&quot;</div><div class="line">).first!) : highestConfidenceResult.identifier</div><div class="line">        </div><div class="line">    </div><div class="line">if</div><div class="line"> identifier == objectLabel.text! &#123;</div><div class="line">        currentScore += </div><div class="line">1</div><div class="line">/</div><div class="line">extObject()</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>This function is called after a prediction. It first has two guards to make sure that there is actually a result. If there is, it will take the result with the highest confidence and put it into its own string called<code>identifier</code>. Then the function will check to see if the identifier is the same as the object label’s text. If they are equal, that means the player found the correct object and the score will be increased. There is also a function call for<code>nextObject</code>which is commented out. We have not yet created that function so leave it that way for now.</p>
<p>Okay! So we are done with the majority of the Core ML code for the game. Isn’t that easy? Your<code>predict</code>and<code>results</code>functions should look like this:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">func</div><div class="line">predict</div><div class="line">(image: CGImage)</div><div class="line"> &#123;</div><div class="line">    </div><div class="line">let</div><div class="line"> model = </div><div class="line">try</div><div class="line">! </div><div class="line">VNCoreMLModel</div><div class="line">(</div><div class="line">for</div><div class="line">: </div><div class="line">Inceptionv3</div><div class="line">().model)</div><div class="line">    </div><div class="line">let</div><div class="line"> request = </div><div class="line">VNCoreMLRequest</div><div class="line">(model: model, completionHandler: results)</div><div class="line">    </div><div class="line">let</div><div class="line"> handler = </div><div class="line">VNSequenceRequestHandler</div><div class="line">()</div><div class="line">    </div><div class="line">try</div><div class="line">! handler.perform([request], on: image)</div><div class="line">&#125;</div><div class="line">    </div><div class="line"></div><div class="line">func</div><div class="line">results</div><div class="line">(request: VNRequest, error: Error?)</div><div class="line"> &#123;</div><div class="line">    </div><div class="line">guard</div><div class="line">let</div><div class="line"> results = request.results </div><div class="line">as</div><div class="line">? [</div><div class="line">VNClassificationObservation</div><div class="line">] </div><div class="line">else</div><div class="line"> &#123;</div><div class="line">        </div><div class="line">print</div><div class="line">(</div><div class="line">&quot;No result found&quot;</div><div class="line">)</div><div class="line">        </div><div class="line">return</div><div class="line"></div><div class="line">    &#125;</div><div class="line">        </div><div class="line">        </div><div class="line">    </div><div class="line">guard</div><div class="line"> results.</div><div class="line">count</div><div class="line"> != </div><div class="line">0</div><div class="line">else</div><div class="line"> &#123;</div><div class="line">        </div><div class="line">print</div><div class="line">(</div><div class="line">&quot;No result found&quot;</div><div class="line">)</div><div class="line">        </div><div class="line">return</div><div class="line"></div><div class="line">    &#125;</div><div class="line">        </div><div class="line">    </div><div class="line">let</div><div class="line"> highestConfidenceResult = results.first!</div><div class="line">    </div><div class="line">let</div><div class="line"> identifier = highestConfidenceResult.identifier.</div><div class="line">contains</div><div class="line">(</div><div class="line">&quot;, &quot;</div><div class="line">) ? </div><div class="line">String</div><div class="line">(describing: highestConfidenceResult.identifier.</div><div class="line">split</div><div class="line">(separator: </div><div class="line">&quot;,&quot;</div><div class="line">).first!) : highestConfidenceResult.identifier</div><div class="line">        </div><div class="line">    </div><div class="line">if</div><div class="line"> identifier == objectLabel.text! &#123;</div><div class="line">        currentScore += </div><div class="line">1</div><div class="line">/</div><div class="line">extObject()</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>One more thing we need to do before we are done with the Core ML part of this game. We need to add an extension to call the predict function. Add the following code the the very bottom of the file, after the last bracket:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">extension</div><div class="line">ViewController</div><div class="line">: </div><div class="line">AVCaptureVideoDataOutputSampleBufferDelegate</div><div class="line">&#123;</div><div class="line">    </div><div class="line">func</div><div class="line">captureOutput</div><div class="line">(</div><div class="line">_</div><div class="line"> output: AVCaptureOutput, didOutput sampleBuffer: CMSampleBuffer, from connection: AVCaptureConnection)</div><div class="line"> &#123;</div><div class="line">        </div><div class="line">guard</div><div class="line">let</div><div class="line"> pixelBuffer = </div><div class="line">CMSampleBufferGetImageBuffer</div><div class="line">(sampleBuffer) </div><div class="line">else</div><div class="line"> &#123; </div><div class="line">fatalError</div><div class="line">(</div><div class="line">&quot;pixel buffer is nil&quot;</div><div class="line">) &#125;</div><div class="line">        </div><div class="line">let</div><div class="line"> ciImage = </div><div class="line">CIImage</div><div class="line">(cvPixelBuffer: pixelBuffer)</div><div class="line">        </div><div class="line">let</div><div class="line"> context = </div><div class="line">CIContext</div><div class="line">(options: </div><div class="line">nil</div><div class="line">)</div><div class="line">        </div><div class="line">        </div><div class="line">guard</div><div class="line">let</div><div class="line"> cgImage = context.createCGImage(ciImage, from: ciImage.extent) </div><div class="line">else</div><div class="line"> &#123; </div><div class="line">fatalError</div><div class="line">(</div><div class="line">&quot;cg image&quot;</div><div class="line">) &#125;</div><div class="line">        </div><div class="line">let</div><div class="line"> uiImage = </div><div class="line">UIImage</div><div class="line">(cgImage: cgImage, scale: </div><div class="line">1.0</div><div class="line">, orientation: .leftMirrored)</div><div class="line">        </div><div class="line">        </div><div class="line">DispatchQueue</div><div class="line">.main.sync &#123;</div><div class="line">            predict(image: uiImage.cgImage!)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>This extension adopts the<code>AVCaptureVideoDataOutputSampleBufferDelegate</code>protocol to process the captured video sample buffers, and creates a CGImage from the video feed. With the images, we pass it to the predict function. You should now be able to build your project without any errors. This is how we continuously capture video and pass it to the built-in machine learning model for object recognition.</p>
<h2 id="Preparing-an-Array-of-Objects-for-the-Game"><a href="#Preparing-an-Array-of-Objects-for-the-Game" class="headerlink" title="Preparing an Array of Objects for the Game"></a>Preparing an Array of Objects for the Game</h2><p>In order for the game to give the player random objects to look for, we have to prepare a list of objects to choose from. To do this, we will create an array with the names of a bunch of objects. Later we will create a function to choose an element from this array randomly and tell the player to go find it.</p>
<p>This is going to be a somewhat lengthy array, so for organization purposes, I have decided to create it in a struct in a separate Swift file. Right click in the project navigator and choose<code>New File...</code>.</p>
<p>Now select the Swift File option and click<em>next</em>. Name the file “Objects” and click<em>create</em>. Place the following code snippet into the file after the<code>import</code>statement:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">struct</div><div class="line">Objects</div><div class="line"> &#123;</div><div class="line">    </div><div class="line">let</div><div class="line"> objectArray = [</div><div class="line">&quot;computer keyboard&quot;</div><div class="line">, </div><div class="line">&quot;mouse&quot;</div><div class="line">, </div><div class="line">&quot;iPod&quot;</div><div class="line">, </div><div class="line">&quot;printer&quot;</div><div class="line">, </div><div class="line">&quot;digital clock&quot;</div><div class="line">, </div><div class="line">&quot;digital watch&quot;</div><div class="line">, </div><div class="line">&quot;backpack&quot;</div><div class="line">, </div><div class="line">&quot;ping-pong ball&quot;</div><div class="line">, </div><div class="line">&quot;envelope&quot;</div><div class="line">, </div><div class="line">&quot;water bottle&quot;</div><div class="line">, </div><div class="line">&quot;combination lock&quot;</div><div class="line">, </div><div class="line">&quot;lampshade&quot;</div><div class="line">, </div><div class="line">&quot;switch&quot;</div><div class="line">, </div><div class="line">&quot;lighter&quot;</div><div class="line">, </div><div class="line">&quot;pillow&quot;</div><div class="line">, </div><div class="line">&quot;spider web&quot;</div><div class="line">, </div><div class="line">&quot;sandal&quot;</div><div class="line">, </div><div class="line">&quot;vacuum&quot;</div><div class="line">, </div><div class="line">&quot;wall clock&quot;</div><div class="line">, </div><div class="line">&quot;bath towel&quot;</div><div class="line">, </div><div class="line">&quot;wallet&quot;</div><div class="line">, </div><div class="line">&quot;poster&quot;</div><div class="line">, </div><div class="line">&quot;chocolate&quot;</div><div class="line">]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Here I have created an array called<code>objectArray</code>of some common, random, household objects that the Core ML model looks for. These are just a select few so feel free to add more.</p>
<p>Now go back to<code>ViewController.swift</code>before we jump into the next step.</p>
<h2 id="Saving-the-Score"><a href="#Saving-the-Score" class="headerlink" title="Saving the Score"></a>Saving the Score</h2><p>We will be saving the player’s highest score using<code>UserDefaults</code>. This means that we need a setter function to save the score into UserDefaults and a getter function to retrieve it.</p>
<p>Add the following two functions to your code after the results function:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">func</div><div class="line">getHighScore</div><div class="line">()</div><div class="line"> &#123;</div><div class="line">    </div><div class="line">if</div><div class="line">let</div><div class="line"> score = </div><div class="line">UserDefaults</div><div class="line">.standard.object(forKey: </div><div class="line">&quot;highscore&quot;</div><div class="line">) &#123;</div><div class="line">        highscoreLabel.text = </div><div class="line">&quot;</div><div class="line">\(score)</div><div class="line">&quot;</div><div class="line"></div><div class="line">        highScore = score </div><div class="line">as</div><div class="line">! </div><div class="line">Int</div><div class="line"></div><div class="line">    &#125;</div><div class="line">    </div><div class="line">else</div><div class="line"> &#123;</div><div class="line">        </div><div class="line">print</div><div class="line">(</div><div class="line">&quot;No highscore, setting to 0.&quot;</div><div class="line">)</div><div class="line">        highscoreLabel.text = </div><div class="line">&quot;0&quot;</div><div class="line"></div><div class="line">        highScore = </div><div class="line">0</div><div class="line"></div><div class="line">        setHighScore(score: </div><div class="line">0</div><div class="line">)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">    </div><div class="line"></div><div class="line">func</div><div class="line">setHighScore</div><div class="line">(score: Int)</div><div class="line"> &#123;</div><div class="line">    </div><div class="line">UserDefaults</div><div class="line">.standard.</div><div class="line">set</div><div class="line">(score, forKey: </div><div class="line">&quot;highscore&quot;</div><div class="line">)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>The first function,<code>getHighScore</code>, uses an<code>if let</code>statement to check if there is already a saved score in UserDefaults. If there is, it sets the<code>highScore</code>variable to it, if not, it sets the<code>highScore</code>to 0. The second function,<code>setHighScore</code>, simply sets the current score as the high score. We will call this when the player beats their score.</p>
<p>The<code>getHighScore</code>function needs to be called when the app loads up. This way, the player can see their high score when they open the app.</p>
<p>Add<code>getHighScore()</code>to the<code>viewDidLoad</code>under the<code>cameraSetup</code>function call. Your<code>ViewDidLoad</code>should look like this:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">override</div><div class="line">func</div><div class="line">viewDidLoad</div><div class="line">() &#123;</div><div class="line">    </div><div class="line">super</div><div class="line">.viewDidLoad</div><div class="line">()</div><div class="line">        </div><div class="line">    </div><div class="line">viewSetup</div><div class="line">()</div><div class="line">    </div><div class="line">cameraSetup</div><div class="line">()</div><div class="line">    </div><div class="line">getHighScore</div><div class="line">()</div><div class="line"> </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Handling-the-Game-Play"><a href="#Handling-the-Game-Play" class="headerlink" title="Handling the Game Play"></a>Handling the Game Play</h2><p>Now it’s time to add a number of different functions to pull everything we have already done together and make this app work. We will start by adding functions to choose a random object from the objects array and handle when the game ends.</p>
<p>Add the following to your code after the<code>setHighScore</code>method:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">//1</div><div class="line">func</div><div class="line">endGame</div><div class="line">()</div><div class="line"> &#123;</div><div class="line">        </div><div class="line">//2</div><div class="line"></div><div class="line">        startButton.isHidden = </div><div class="line">false</div><div class="line"></div><div class="line">        skipButton.isHidden = </div><div class="line">true</div><div class="line"></div><div class="line">        objectLabel.text = </div><div class="line">&quot;Game Over&quot;</div><div class="line">//3</div><div class="line">if</div><div class="line"> currentScore </div><div class="line">&gt;</div><div class="line"> highScore &#123;</div><div class="line">            setHighScore(score: currentScore)</div><div class="line">            highscoreLabel.text = </div><div class="line">&quot;</div><div class="line">\(currentScore)</div><div class="line">&quot;</div><div class="line"></div><div class="line">        &#125;</div><div class="line">        </div><div class="line">//4</div><div class="line"></div><div class="line">        currentScore = </div><div class="line">0</div><div class="line"></div><div class="line">        timeRemaining = </div><div class="line">60</div><div class="line"></div><div class="line">        </div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    </div><div class="line">//5</div><div class="line">func</div><div class="line">nextObject</div><div class="line">()</div><div class="line"> &#123;</div><div class="line">        </div><div class="line">//6</div><div class="line">let</div><div class="line"> allObjects = </div><div class="line">Objects</div><div class="line">().objectArray</div><div class="line">        </div><div class="line">//7</div><div class="line">let</div><div class="line"> randomObjectIndex = </div><div class="line">Int</div><div class="line">(arc4random_uniform(</div><div class="line">UInt32</div><div class="line">(allObjects.</div><div class="line">count</div><div class="line">)))</div><div class="line">        </div><div class="line">//8</div><div class="line">guard</div><div class="line"> allObjects[randomObjectIndex] != objectLabel.text </div><div class="line">else</div><div class="line"> &#123;</div><div class="line">            nextObject()</div><div class="line">            </div><div class="line">return</div><div class="line"></div><div class="line">        &#125;</div><div class="line">        </div><div class="line">//9</div><div class="line"></div><div class="line">        objectLabel.text = allObjects[randomObjectIndex]</div><div class="line">        scoreLabel.text = </div><div class="line">&quot;</div><div class="line">\(currentScore)</div><div class="line">&quot;</div><div class="line"></div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>So what exactly are these functions doing you ask?</p>
<ol>
<li>The<br><code>endGame</code><br>function is called when the timer is up.</li>
<li>We first unhide the start button and hide the skip button since it is no longer needed when the game is not in play. We also set the object label’s text to say “Game Over”.</li>
<li>We check if the score that the player just got is higher than the high score. If it is, than we call the<br><code>setHighScore</code><br>function.</li>
<li>We reset the variables for the next game.</li>
<li>The<br><code>nextObject</code><br>function is called when the player either finds the correct object or taps the skip button. This function will take a random object from the object array and set it to the objects label so the player knows to find it.</li>
<li>We create an instance of the objectArray.</li>
<li>We generate a random number from 0 to the length of the object array.</li>
<li>We use a guard to make sure that the random number that was just chosen is not the same as the last one. This way, the player will not get the same object twice in a row.</li>
<li>We set the object label to the random object and make sure the score label is displaying the correct score.</li>
</ol>
<p>Important:Now that we have created the_nextObject_function, make sure you go back up to the_results_function and uncomment the function call for<em>nextObject</em>.</p>
<p>Next, we need to add the actions that we will connect to the play and skip buttons. Add the following code after the<code>nextObject</code>function:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">@IBAction</div><div class="line">func</div><div class="line">startButtonTapped</div><div class="line">()</div><div class="line"> &#123;</div><div class="line">    </div><div class="line">//1</div><div class="line"></div><div class="line">    gameTimer = </div><div class="line">Timer</div><div class="line">.scheduledTimer(withTimeInterval: </div><div class="line">1</div><div class="line">, repeats: </div><div class="line">true</div><div class="line">, block: &#123; (gameTimer) </div><div class="line">in</div><div class="line">//2</div><div class="line">guard</div><div class="line">self</div><div class="line">.timeRemaining != </div><div class="line">0</div><div class="line">else</div><div class="line"> &#123;</div><div class="line">            gameTimer.invalidate()</div><div class="line">            </div><div class="line">self</div><div class="line">.endGame()</div><div class="line">            </div><div class="line">return</div><div class="line"></div><div class="line">        &#125;</div><div class="line">            </div><div class="line">        </div><div class="line">self</div><div class="line">.timeRemaining -= </div><div class="line">1</div><div class="line">self</div><div class="line">.timerLabel.text = </div><div class="line">&quot;</div><div class="line">\(</div><div class="line">self</div><div class="line">.timeRemaining)</div><div class="line">&quot;</div><div class="line"></div><div class="line">    &#125;)</div><div class="line">    </div><div class="line">//3  </div><div class="line"></div><div class="line">    startButton.isHidden = </div><div class="line">true</div><div class="line"></div><div class="line">    skipButton.isHidden = </div><div class="line">false</div><div class="line"></div><div class="line">    nextObject()</div><div class="line">        </div><div class="line">&#125;</div><div class="line"> </div><div class="line"></div><div class="line">//4  </div><div class="line">@IBAction</div><div class="line">func</div><div class="line">skipButtonTapped</div><div class="line">()</div><div class="line"> &#123;</div><div class="line">    nextObject()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>So what did we do here?</p>
<ol>
<li>First we added an action that will be called when the start button is tapped. Here we initialize the gameTimer using the new method that takes a block to invoke rather than a selector which makes the code much cleaner and more organized.</li>
<li>We add a guard to make sure that there is time left in the game. If there is not, we invalidate the timer and run the<br><code>endGame</code><br>function. If there is time, we subtract one from the time remaining and update the timer label.</li>
<li>Here we hide the startButton, show the skip button, and call the<br><code>nextObject</code><br>function to show the first object to find.</li>
<li>We add an action to connect to the skip button which simply calls for a new object.</li>
</ol>
<p>Important:Now, make sure you go to your storyboard and connect all outlets an actions to the proper elements.</p>
<h2 id="Playing-the-Game"><a href="#Playing-the-Game" class="headerlink" title="Playing the Game"></a>Playing the Game</h2><p>Now it’s finally time to build and run your game. Once loaded, tap the play button and point your phone at the object stated at the top. See how high is your score! You might need to wait a second for the app to focus before it can recognize an object. Also, please note that if you have an older device such as an iPhone 5s or 6, the app might run really slow because of the power and resources that Core ML needs. As I testedt, the game ran great on my iPhone 7. But when I tried it on my iPhone 5s, it was really slow and laggy.</p>
<p><img src="http://img2.tuicool.com/6NnMr2V.png!web" alt=""></p>
<p>In case you were wondering, this model cannot recognize the Nintendo Switch!</p>
<h2 id="Recap"><a href="#Recap" class="headerlink" title="Recap"></a>Recap</h2><p>I hope you had fun creating this game and have some more insight on how much you can do with Core ML. The game is not perfect, there are a lot of things you can improve (say, play a sound when the object is matched). But this is just a simple example showing how you can apply Core ML. So get creative and see how you can improve upon it.</p>
<p>For reference, the complete demo app is available on<a href="https://github.com/appcoda/CoreMLScavenge">GitHub</a>.</p>
<p>For more details about the Core ML framework, you can refer to the<a href="https://developer.apple.com/documentation/coreml">official Core ML documentation</a>.</p>
<p>Do you like this tutorial? Feel free to leave a comment and let me know.</p>
<p>Source: <a href="http://www.tuicool.com/articles/hit/QbeiquA">http://www.appcoda.com/coreml-game/</a></p>

  </div>
  

 <!-- jsSocials -->
<script src="/jssocials-1.4.0/jssocials.min.js"></script>
<link rel="stylesheet" href="/jssocials-1.4.0/jssocials.css">
<link rel="stylesheet" href="/jssocials-1.4.0/jssocials-theme-flat.css">

<div class="socials-share-btn"></div>
<script>
  if ($) {
    $(document).ready(function(){
      $(".socials-share-btn").jsSocials({
        shares: ["email", "twitter", "facebook", "googleplus", "linkedin", "pinterest", "stumbleupon", "whatsapp"]
      });
    })
  }
</script>


  
<section id="comments">
  <div id="disqus_thread"></div>
</section>
<script>
  var disqus_shortname = 'gmagon';
  var disqus_url = 'https://gmagon.com/blog/2017/07/06/creating-a-simple-game-with-core-ml-in-swift-4/index.html';
  var disqus_title = "Creating a Simple Game With Core ML in Swift 4";
  var disqus_config = function(){
    this.language = 'en';
  };
  (function(){
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'https://go.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

  <script src="/js/audios.js"></script>
</article>

          </div>
      
          <aside id="article-toc" role="navigation">
                <div id="article-toc-inner">
                  <strong class="sidebar-title">Contents</strong>
                  <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#App-Overview"><span class="toc-text">App Overview</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Creating-the-Project"><span class="toc-text">Creating the Project</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Creating-the-User-Interface"><span class="toc-text">Creating the User Interface</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Setting-Up-the-View"><span class="toc-text">Setting Up the View</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Setting-Up-the-Camera"><span class="toc-text">Setting Up the Camera</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Adding-the-Core-ML-Data-Model"><span class="toc-text">Adding the Core ML Data Model</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Predicting-the-Object"><span class="toc-text">Predicting the Object</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Preparing-an-Array-of-Objects-for-the-Game"><span class="toc-text">Preparing an Array of Objects for the Game</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Saving-the-Score"><span class="toc-text">Saving the Score</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Handling-the-Game-Play"><span class="toc-text">Handling the Game Play</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Playing-the-Game"><span class="toc-text">Playing the Game</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Recap"><span class="toc-text">Recap</span></a></li></ol>
                  <a href="#" id="article-toc-top">Back to Top</a>
                </div>
          </aside>
        </div>
      </article>
    </div>
  </div>
</div>

<div class="class-content-wrap">
  <div class="inner">
    <div class="inner-wrap landing-bunting">
      <div class="intro-sub-content-wrap">
      </div>
    </div>
  </div>
</div>



    <footer id="footer" class="landing-bunting font-e3">
  <div class="inner">
    <div id="footer-some-docs">
        <a href="/terms_conditions.html" class="footer-doc-link" >Terms & Conditions</a>
        <a href="/privacy.html" class="footer-doc-link" >Privacy</a>
        <a href="/end-user-license-agreement.html" class="footer-doc-link" >License Agreement</a>
    </div>
    <div id="footer-copyright">
       <a href="" > Copyright &copy; 2017 Gmagon,Inc. All rights reserved. </a>
    </div>
  </div>

  <div class="inner">
    <div id="footer-links">
        
        <a href="https://twitter.com/gmagonshare" class="footer-link" target="_blank" rel="nofollow me noopener noreferrer" ><i class="fa fa-twitter"></i></a>
        
        <a href="https://www.facebook.com/gmagonshare" class="footer-link" target="_blank" rel="nofollow me noopener noreferrer" ><i class="fa fa-facebook"></i></a>
        <a href="https://www.youtube.com/gmagonshare" class="footer-link" target="_blank" rel="nofollow me noopener noreferrer" ><i class="fa fa-youtube"></i></a>
        <a href="https://www.instagram.com/gmagonshare" class="footer-link" target="_blank" rel="nofollow me noopener noreferrer" ><i class="fa fa-instagram"></i></a>
    </div>
  </div>


  <div class="inner">
    <div id="footer-security">
       <p>
          <img src="/asset/images/security/klogo.png">
          <img src="/asset/images/security/mcafee.png">
          <img src="/asset/images/security/cmmodo_scanned.png">
          <img src="/asset/images/security/softonic_tested.png">
          <img src="/asset/images/security/tested_by_sucuri.png">
          <img src="/asset/images/security/norton.png">
          <img src="/asset/images/security/eset_logo.png">
       </p>
    </div>
  </div>




</footer>

  </div>
  <div id="mobile-nav-dimmer"></div>
  <nav id="mobile-nav">
  <div id="mobile-nav-inner">
    <ul id="mobile-nav-list">
      <a href="/" class="mobile-nav-link ">Home</a><a href="/products/" class="mobile-nav-link ">Products</a><a href="/guide/" class="mobile-nav-link ">Guide</a><a href="/support/" class="mobile-nav-link ">Support</a><a href="/blog/" class="mobile-nav-link ">Blog</a>
      
    </ul>
    
  </div>
  <div id="mobile-lang-select-wrap">
    <span id="mobile-lang-select-label"><i class="fa fa-globe"></i><span>English</span></span>
    <select id="mobile-lang-select" data-canonical="">
      
        <option value="en" selected>English</option>
      
    </select>
  </div>
</nav>

  <!-- Scripts -->
<script src="/build/js/main-8277743eaa.js"></script>
<!-- <script src="https://cdn.jsdelivr.net/retinajs/1.3.0/retina.min.js" async></script> -->

<!-- totop -->
<div id="gmagon_totop" style="position:fixed;bottom:150px;right:30px;cursor: pointer;">
  <a title="Back to top"><img src="/asset/images/scroll-up.png"/></a>
</div>
<script src="/js/totop.js"></script>





<!-- Google Analytics -->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-99314951-1', 'auto');
  ga('send', 'pageview');
</script>


</body>
</html>